<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src 'self' ws: wss:; img-src 'self' data:;">
    <title>SimpleMC--æˆ‘çš„ä¸–ç•ŒæœåŠ¡å™¨ç®¡ç†é¢æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #3498db;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #95a5a6;
        }

        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* ç™»å½•ç•Œé¢æ ·å¼ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-card h1 {
            color: var(--dark);
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .login-error {
            color: var(--danger);
            margin-top: 10px;
            display: none;
        }

        /* ä¸»ç•Œé¢æ ·å¼ - éšè—ç›´åˆ°ç™»å½• */
        .main-interface {
            display: none;
        }

        /* å¤´éƒ¨æ ·å¼ */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header h1 {
            color: var(--dark);
            font-size: 2.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header h1::before {
            content: "ğŸ®";
            font-size: 2.2rem;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status {
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status::before {
            content: "";
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        .status.disconnected {
            background: #ffebee;
            color: #c62828;
        }
        .status.disconnected::before { background: #c62828; }

        .status.connected {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .status.connected::before { background: #2e7d32; }

        .status.connecting {
            background: #fff3e0;
            color: #ef6c00;
        }
        .status.connecting::before { background: #ef6c00; }

        .connection-panel {
            display: grid;
            grid-template-columns: 1fr 1fr auto auto;
            gap: 20px;
            align-items: end;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            color: var(--dark);
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .input-group input {
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(39, 174, 96, 0.3);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-small {
            padding: 10px 18px;
            font-size: 12px;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary);
        }

        .card h2 {
            color: var(--dark);
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-actions {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }

        /* ç®¡ç†å¡ç‰‡å®¹å™¨æ ·å¼ - é™åˆ¶é«˜åº¦å¹¶æ·»åŠ æ»šåŠ¨æ¡ */
        .management-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            background: #f8f9fa;
        }

        .management-container::-webkit-scrollbar {
            width: 8px;
        }

        .management-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .management-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .management-container::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* æœç´¢æ æ ·å¼ */
        .search-container {
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* æ§åˆ¶å°æ—¥å¿— */
        .log-container {
            background: #1e1e1e;
            border-radius: 12px;
            padding: 20px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }

        .log-entry {
            margin-bottom: 10px;
            padding: 5px 0;
            border-bottom: 1px solid #2a2a2a;
        }

        .log-entry.info { color: #4fc3f7; }
        .log-entry.success { color: #66bb6a; }
        .log-entry.error { color: #ef5350; }
        .log-entry.warning { color: #ffb74d; }

        .command-input {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .command-input input {
            flex: 1;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            background: white;
        }

        /* ç´§å‡‘çš„ç©å®¶é¡¹æ ·å¼ */
        .compact-player-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border-left: 3px solid var(--primary);
            font-size: 0.9rem;
        }

        .compact-player-item:hover {
            transform: translateX(3px);
            background: #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .compact-player-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .compact-player-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 2px;
        }

        .compact-player-uuid {
            color: var(--gray);
            font-size: 0.7rem;
            font-family: 'Consolas', monospace;
        }

        .compact-player-actions {
            display: flex;
            gap: 6px;
        }

        /* æ¸¸æˆè§„åˆ™å¼€å…³æ ·å¼ */
        .gamerule-item {
            background: #f8f9fa;
            padding: 18px;
            margin-bottom: 12px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary);
        }

        .gamerule-item:hover {
            transform: translateX(3px);
            background: #e9ecef;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .gamerule-info {
            flex: 1;
        }

        .gamerule-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 4px;
            font-size: 1rem;
        }

        .gamerule-description {
            color: var(--gray);
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .gamerule-type {
            display: inline-block;
            padding: 2px 8px;
            background: var(--info);
            color: white;
            border-radius: 10px;
            font-size: 0.75rem;
            margin-left: 8px;
        }

        .gamerule-type.boolean { background: var(--success); }
        .gamerule-type.number { background: var(--info); }
        .gamerule-type.string { background: var(--warning); }

        .gamerule-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        /* å¼€å…³æŒ‰é’®æ ·å¼ */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--success);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        input:disabled + .slider {
            background-color: #e0e0e0;
            cursor: not-allowed;
        }

        input:disabled + .slider:before {
            background-color: #f5f5f5;
        }

        /* æ•°å­—è¾“å…¥æ ·å¼ */
        .number-input {
            width: 120px;
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
        }

        .number-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* æ–‡æœ¬è¾“å…¥æ ·å¼ */
        .text-input {
            width: 200px;
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* è§„åˆ™å€¼æ˜¾ç¤º */
        .gamerule-value {
            font-family: 'Consolas', monospace;
            background: var(--light);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.9rem;
            min-width: 80px;
            text-align: center;
        }

        .gamerule-value.true { background: #e8f5e9; color: var(--success); }
        .gamerule-value.false { background: #ffebee; color: var(--danger); }
        .gamerule-value.number { background: #e3f2fd; color: var(--info); }
        .gamerule-value.string { background: #fff3e0; color: var(--warning); }

        /* æ“ä½œæŒ‰é’® */
        .gamerule-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .gamerule-btn.apply {
            background: var(--success);
            color: white;
        }

        .gamerule-btn.apply:hover:not(:disabled) {
            background: #229954;
            transform: translateY(-1px);
        }

        .gamerule-btn.reset {
            background: var(--gray);
            color: white;
        }

        .gamerule-btn.reset:hover:not(:disabled) {
            background: #7f8c8d;
            transform: translateY(-1px);
        }

        .gamerule-btn.toggle {
            background: var(--success);
            color: white;
            min-width: 60px;
        }

        .gamerule-btn.toggle.off {
            background: var(--danger);
        }

        .gamerule-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* è§„åˆ™åˆ†ç»„ */
        .gamerule-category {
            margin-bottom: 25px;
        }

        .gamerule-category h3 {
            color: var(--dark);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
            font-size: 1.2rem;
        }

        /* æœç´¢å’Œç­›é€‰ */
        .gamerule-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-input {
            flex: 1;
            min-width: 250px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
        }

        .filter-select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
            min-width: 150px;
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* å…¨å®½å¡ç‰‡ */
        .full-width {
            grid-column: 1 / -1;
        }

        /* äº‹ä»¶å®¹å™¨ */
        .events-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .event-item {
            background: white;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 10px;
            border-left: 4px solid var(--info);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .event-time {
            color: var(--gray);
            font-size: 11px;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .event-type {
            font-weight: 600;
            color: var(--info);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .event-data {
            color: var(--dark);
            font-size: 12px;
            font-family: 'Consolas', monospace;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
            overflow-x: auto;
        }

        /* è¡¨å•ç»„ */
        .form-group {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .form-group input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
        }

        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray);
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ç™½åå•çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .whitelist-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-indicator.on {
            background: var(--success);
        }

        .status-indicator.off {
            background: var(--danger);
        }

        /* RCON çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .rcon-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .rcon-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .rcon-indicator.on {
            background: var(--success);
        }

        .rcon-indicator.off {
            background: var(--danger);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header-top {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .connection-panel {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .connection-status {
                justify-content: flex-start;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .card {
                padding: 20px;
            }
            
            .form-group {
                flex-direction: column;
            }
            
            .form-group input {
                min-width: 100%;
            }

            .gamerule-filters {
                flex-direction: column;
            }

            .gamerule-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .gamerule-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            color: var(--gray);
            padding: 40px 20px;
            font-style: italic;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* æœåŠ¡å™¨çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .server-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .server-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .server-indicator.on {
            background: var(--success);
            animation: pulse 2s infinite;
        }

        .server-indicator.off {
            background: var(--danger);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div class="login-container" id="loginContainer">
        <div class="login-card">
            <h1>ğŸ” ç®¡ç†å‘˜ç™»å½•</h1>
            <input type="text" class="login-input" id="loginUsername" placeholder="ç”¨æˆ·å">
            <input type="password" class="login-input" id="loginPassword" placeholder="å¯†ç ">
            <button class="login-btn" onclick="login()">ç™»å½•</button>
            <div class="login-error" id="loginError">ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯</div>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div class="main-interface" id="mainInterface">
        <div class="container">
            <div class="header">
                <div class="header-top">
                    <h1>SimpleMC æˆ‘çš„ä¸–ç•ŒæœåŠ¡å™¨ç®¡ç†é¢æ¿</h1>
                    <div class="connection-status">
                        <span class="status disconnected" id="statusIndicator">
                            <span class="status-text">æœªè¿æ¥</span>
                        </span>
                        <button class="btn btn-warning btn-small" onclick="logout()">ğŸšª é€€å‡ºç™»å½•</button>
                    </div>
                </div>
                
                <div class="connection-panel">
                    <div class="input-group">
                        <label>ğŸ–¥ï¸ ä»£ç†æœåŠ¡å™¨åœ°å€</label>
                        <input type="text" id="wsHost" value="" placeholder="ä¾‹å¦‚: localhost æˆ– 127.0.0.1">
                    </div>
                    <div class="input-group">
                        <label>ğŸ”Œ ä»£ç†æœåŠ¡å™¨ç«¯å£</label>
                        <input type="number" id="wsPort" value="" placeholder="é»˜è®¤: 8765">
                    </div>
                    <button class="btn btn-primary" onclick="connect()" id="connectBtn">
                        <span>ğŸ”— è¿æ¥æœåŠ¡å™¨</span>
                    </button>
                    <button class="btn btn-danger" onclick="disconnect()" id="disconnectBtn" disabled>
                        <span>âŒ æ–­å¼€è¿æ¥</span>
                    </button>
                </div>
            </div>

            <div class="main-content">
                <!-- æ§åˆ¶å°æ—¥å¿— -->
                <div class="card full-width">
                    <div class="card-header">
                        <h2>ğŸ“ æœåŠ¡å™¨æ§åˆ¶å°</h2>
                        <div class="rcon-status">
                            <span class="rcon-indicator off" id="rconStatusIndicator"></span>
                            <span id="rconStatusText">RCON çŠ¶æ€: æ£€æµ‹ä¸­...</span>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-info btn-small" onclick="clearLogs()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
                        </div>
                    </div>

                    <div class="server-status">
                        <span class="server-indicator off" id="serverStatusIndicator"></span>
                        <span id="serverStatusText">æœåŠ¡å™¨çŠ¶æ€: æ£€æµ‹ä¸­...</span>
                        <div style="margin-left: auto; display: flex; gap: 10px;">
                            <button class="btn btn-primary btn-small" onclick="startServer()" id="startServerBtn">ğŸš€ å¯åŠ¨æœåŠ¡å™¨</button>
                            <button class="btn btn-success btn-small" onclick="saveAll()">ğŸ’¾ ä¿å­˜ä¸–ç•Œ</button>
                            <button class="btn btn-danger btn-small" onclick="stopServer()" id="normalStopBtn">ğŸ›‘ åœæ­¢æœåŠ¡å™¨</button>
                            <button class="btn btn-danger btn-small" onclick="forceStopServer()" id="forceStopBtn">ğŸ›‘ å¼ºåˆ¶åœæ­¢</button>
                        </div>
                    </div>
                    <div class="log-container" id="logContainer"></div>
                    <div class="command-input">
                        <input type="text" id="commandInput" placeholder="è¾“å…¥ Minecraft æœåŠ¡å™¨å‘½ä»¤ (å¦‚: time set day, give player diamond...)..." onkeypress="handleCommandKeypress(event)">
                        <button class="btn btn-success" onclick="executeRconCommand()">ğŸš€ æ‰§è¡Œå‘½ä»¤</button>
                    </div>
                </div>

                <!-- ä¸¤åˆ—å¸ƒå±€ -->
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ‘¥ åœ¨çº¿ç©å®¶</h2>
                        <div class="card-actions">
                            <button class="btn btn-primary btn-small" onclick="getPlayers()">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" class="search-input" id="playersSearch" placeholder="ğŸ” æœç´¢ç©å®¶..." oninput="filterPlayers()">
                    </div>
                    <div class="management-container">
                        <ul class="players-list" id="playersList">
                            <li class="empty-state">ç‚¹å‡»åˆ·æ–°æŒ‰é’®è·å–åœ¨çº¿ç©å®¶åˆ—è¡¨</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>âš¡ æœåŠ¡å™¨äº‹ä»¶</h2>
                        <div class="card-actions">
                            <button class="btn btn-info btn-small" onclick="clearEvents()">ğŸ—‘ï¸ æ¸…ç©ºäº‹ä»¶</button>
                        </div>
                    </div>
                    <div class="management-container">
                        <div id="eventsContainer">
                            <div class="empty-state">æœåŠ¡å™¨äº‹ä»¶å°†åœ¨è¿™é‡Œæ˜¾ç¤º</div>
                        </div>
                    </div>
                </div>

                <!-- ç®¡ç†åŠŸèƒ½æ ‡ç­¾é¡µ -->
                <div class="card full-width">
                    <div class="card-header">
                        <h2>ğŸ›¡ï¸ æœåŠ¡å™¨ç®¡ç†</h2>
                    </div>
                    
                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('whitelist')">âœ… ç™½åå•</button>
                        <button class="tab" onclick="switchTab('bans')">ğŸš« å°ç¦ç®¡ç†</button>
                        <button class="tab" onclick="switchTab('admins')">ğŸ‘‘ ç®¡ç†å‘˜</button>
                        <button class="tab" onclick="switchTab('gamerules')">âš™ï¸ æ¸¸æˆè§„åˆ™</button>
                    </div>

                    <!-- ç™½åå•ç®¡ç† -->
                    <div class="tab-content active" id="whitelist-tab">
                        <div class="whitelist-status">
                            <span class="status-indicator off" id="whitelistStatusIndicator"></span>
                            <span id="whitelistStatusText">æ­£åœ¨è·å–ç™½åå•çŠ¶æ€...</span>
                            <div style="margin-left: auto; display: flex; gap: 10px;">
                                <button class="btn btn-success btn-small" onclick="toggleWhitelist(true)" id="enableWhitelistBtn">âœ… å¯ç”¨ç™½åå•</button>
                                <button class="btn btn-danger btn-small" onclick="toggleWhitelist(false)" id="disableWhitelistBtn">âŒ å…³é—­ç™½åå•</button>
                            </div>
                        </div>
                        <div class="search-container">
                            <input type="text" class="search-input" id="whitelistSearch" placeholder="ğŸ” æœç´¢ç©å®¶åç§°..." oninput="filterWhitelist()">
                        </div>
                        <div class="form-group">
                            <input type="text" id="addWhitelistPlayer" placeholder="è¾“å…¥ç©å®¶åç§°">
                            <button class="btn btn-success" onclick="addToWhitelist()">â• æ·»åŠ ç©å®¶</button>
                            <button class="btn btn-primary" onclick="getWhitelist()">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
                        </div>
                        <div class="management-container">
                            <div id="whitelistContainer">
                                <div class="empty-state">ç™½åå•åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º</div>
                            </div>
                        </div>
                    </div>

                    <!-- å°ç¦ç®¡ç† -->
                    <div class="tab-content" id="bans-tab">
                        <div class="search-container">
                            <input type="text" class="search-input" id="bansSearch" placeholder="ğŸ” æœç´¢ç©å®¶åç§°æˆ–IP..." oninput="filterBans()">
                        </div>
                        <div class="form-group">
                            <input type="text" id="banPlayerName" placeholder="ç©å®¶åç§°">
                            <input type="text" id="banReason" placeholder="å°ç¦åŸå› ">
                            <button class="btn btn-danger" onclick="banPlayer()">ğŸš« å°ç¦ç©å®¶</button>
                            <button class="btn btn-warning" onclick="getBans()">ğŸ”„ åˆ·æ–°ç©å®¶å°ç¦</button>
                        </div>
                        <div class="form-group">
                            <input type="text" id="banIP" placeholder="IPåœ°å€">
                            <input type="text" id="banIPReason" placeholder="å°ç¦åŸå› ">
                            <button class="btn btn-danger" onclick="banIP()">ğŸŒ å°ç¦ IP</button>
                            <button class="btn btn-warning" onclick="getIPBans()">ğŸ”„ åˆ·æ–° IP å°ç¦</button>
                        </div>
                        <div class="management-container">
                            <div id="bansContainer">
                                <div class="empty-state">å°ç¦åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º</div>
                            </div>
                        </div>
                    </div>

                    <!-- ç®¡ç†å‘˜ç®¡ç† -->
                    <div class="tab-content" id="admins-tab">
                        <div class="search-container">
                            <input type="text" class="search-input" id="adminsSearch" placeholder="ğŸ” æœç´¢ç®¡ç†å‘˜..." oninput="filterAdmins()">
                        </div>
                        <div class="form-group">
                            <input type="text" id="addAdminPlayer" placeholder="ç©å®¶åç§°">
                            <input type="number" id="adminLevel" placeholder="æƒé™ç­‰çº§ (0-4)" min="0" max="4" value="4">
                            <button class="btn btn-success" onclick="addAdmin()">â• æ·»åŠ ç®¡ç†å‘˜</button>
                            <button class="btn btn-primary" onclick="getAdmins()">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
                        </div>
                        <div class="management-container">
                            <div id="adminsContainer">
                                <div class="empty-state">ç®¡ç†å‘˜åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º</div>
                            </div>
                        </div>
                    </div>

                    <!-- æ¸¸æˆè§„åˆ™ç®¡ç† -->
                    <div class="tab-content" id="gamerules-tab">
                        <div class="gamerule-filters">
                            <input type="text" class="filter-input" id="ruleSearch" placeholder="ğŸ” æœç´¢æ¸¸æˆè§„åˆ™..." onkeyup="filterRules()">
                            <select class="filter-select" id="ruleCategoryFilter" onchange="filterRules()">
                                <option value="all">æ‰€æœ‰åˆ†ç±»</option>
                                <option value="gameplay">æ¸¸æˆç©æ³•</option>
                                <option value="world">ä¸–ç•Œè®¾ç½®</option>
                                <option value="player">ç©å®¶ç›¸å…³</option>
                                <option value="mob">ç”Ÿç‰©ç›¸å…³</option>
                                <option value="chat">èŠå¤©ç›¸å…³</option>
                            </select>
                        </div>
                        <div class="management-container">
                            <div id="gameRulesList">
                                <div class="empty-state">ç‚¹å‡»åŠ è½½æŒ‰é’®è·å–æ¸¸æˆè§„åˆ™</div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="getGameRules()">ğŸ”„ åŠ è½½è§„åˆ™</button>
                            <button class="btn btn-info" onclick="resetAllRules()">ğŸ”„ é‡ç½®æ‰€æœ‰</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å®‰å…¨éªŒè¯
        class SecurityUtils {
            static validateCommand(command) {
                if (!command || command.length > 1000) {
                    return false;
                }
                
                // ç¦æ­¢çš„å±é™©å‘½ä»¤
                const dangerousCommands = [
                    'sudo', 'rm -rf', 'del /f', 'format', 'mkfs', 'dd if=',
                    'shutdown', 'reboot', 'init', 'chmod 777', 'passwd'
                ];
                
                const commandLower = command.toLowerCase();
                for (const dangerous of dangerousCommands) {
                    if (commandLower.includes(dangerous)) {
                        return false;
                    }
                }
                
                return true;
            }
            
            static sanitizeInput(input) {
                if (!input) return '';
                
                const replacements = {
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#x27;',
                    '&': '&amp;',
                    '/': '&#x2F;',
                    '`': '&#x60;',
                    '=': '&#x3D;'
                };
                
                return input.replace(/[<>&"'`=/]/g, char => replacements[char] || char);
            }
            
            static validateUsername(username) {
                if (!username || username.length > 50) {
                    return false;
                }
                return /^[a-zA-Z0-9_-]+$/.test(username);
            }
        }

        // å…¨å±€å˜é‡
        let ws = null;
        let sessionId = null;
        let requestId = 1;
        let pendingRequests = {};
        let isConnected = false;
        let whitelistEnabled = false;
        let rconEnabled = false;
        let serverRunning = false;
        let serverOutputWs = null;
        let statusPollInterval = null;

        // æ¸¸æˆè§„åˆ™åˆ†ç±»æ˜ å°„
        const ruleCategories = {
            'announceAdvancements': 'chat',
            'commandBlockOutput': 'chat',
            'disableElytraMovementCheck': 'player',
            'disableRaids': 'mob',
            'doDaylightCycle': 'gameplay',
            'doEntityDrops': 'gameplay',
            'doFireTick': 'gameplay',
            'doImmediateRespawn': 'player',
            'doInsomnia': 'mob',
            'doLimitedCrafting': 'gameplay',
            'doMobLoot': 'mob',
            'doMobSpawning': 'mob',
            'doPatrolSpawning': 'mob',
            'doTileDrops': 'gameplay',
            'doTraderSpawning': 'mob',
            'doWeatherCycle': 'gameplay',
            'drowningDamage': 'player',
            'fallDamage': 'player',
            'fireDamage': 'player',
            'forgiveDeadPlayers': 'mob',
            'freezeDamage': 'player',
            'keepInventory': 'player',
            'logAdminCommands': 'chat',
            'maxCommandChainLength': 'world',
            'maxEntityCramming': 'world',
            'mobGriefing': 'gameplay',
            'naturalRegeneration': 'player',
            'playersSleepingPercentage': 'player',
            'randomTickSpeed': 'world',
            'reducedDebugInfo': 'player',
            'sendCommandFeedback': 'chat',
            'showDeathMessages': 'player',
            'spawnRadius': 'player',
            'spectatorsGenerateChunks': 'world',
            'universalAnger': 'mob',
            'allowEnteringNetherUsingPortals': 'gameplay',
            'allowFireTicksAwayFromPlayer': 'gameplay',
            'blockExplosionDropDecay': 'gameplay',
            'commandBlocksEnabled': 'gameplay',
            'commandModificationBlockLimit': 'world',
            'disablePlayerMovementCheck': 'player',
            'doVinesSpread': 'world',
            'doWardenSpawning': 'mob',
            'enderPearlsVanishOnDeath': 'player',
            'globalSoundEvents': 'gameplay',
            'lavaSourceConversion': 'world',
            'locatorBar': 'player',
            'maxCommandForkCount': 'world',
            'mobExplosionDropDecay': 'gameplay',
            'playersNetherPortalCreativeDelay': 'player',
            'playersNetherPortalDefaultDelay': 'player',
            'projectilesCanBreakBlocks': 'gameplay',
            'pvp': 'player',
            'snowAccumulationHeight': 'world',
            'spawnMonsters': 'mob',
            'spawnerBlocksEnabled': 'gameplay',
            'tntExplodes': 'gameplay',
            'tntExplosionDropDecay': 'gameplay',
            'waterSourceConversion': 'world'
        };

        // è§„åˆ™æè¿°
        const ruleDescriptions = {
            'announceAdvancements': 'æ˜¯å¦åœ¨èŠå¤©æ ä¸­å…¬å‘Šç©å®¶è·å¾—çš„è¿›åº¦',
            'commandBlockOutput': 'å‘½ä»¤æ–¹å—æ‰§è¡Œå‘½ä»¤æ—¶æ˜¯å¦åœ¨èŠå¤©æ æ˜¾ç¤º',
            'disableElytraMovementCheck': 'æ˜¯å¦ç¦ç”¨é˜ç¿…ç§»åŠ¨æ£€æŸ¥ï¼ˆå¯ç”¨äºåä½œå¼Šï¼‰',
            'disableRaids': 'æ˜¯å¦ç¦ç”¨è¢­å‡»äº‹ä»¶',
            'doDaylightCycle': 'æ˜¯å¦è¿›è¡Œæ˜¼å¤œäº¤æ›¿',
            'doEntityDrops': 'å®ä½“æ­»äº¡æ—¶æ˜¯å¦æ‰è½ç‰©å“',
            'doFireTick': 'ç«æ˜¯å¦ä¼šè”“å»¶å’Œè‡ªç„¶ç†„ç­',
            'doImmediateRespawn': 'æ­»äº¡åæ˜¯å¦ç«‹å³é‡ç”Ÿï¼ˆè·³è¿‡æ­»äº¡ç•Œé¢ï¼‰',
            'doInsomnia': 'æ˜¯å¦ç”Ÿæˆå¹»ç¿¼ï¼ˆå¤±çœ æœºåˆ¶ï¼‰',
            'doLimitedCrafting': 'ç©å®¶æ˜¯å¦åªèƒ½åˆæˆå·²è§£é”çš„é…æ–¹',
            'doMobLoot': 'ç”Ÿç‰©æ­»äº¡æ—¶æ˜¯å¦æ‰è½æˆ˜åˆ©å“',
            'doMobSpawning': 'æ˜¯å¦è‡ªç„¶ç”Ÿæˆç”Ÿç‰©',
            'doPatrolSpawning': 'æ˜¯å¦ç”Ÿæˆç¾å„å·¡é€»é˜Ÿ',
            'doTileDrops': 'ç ´åæ–¹å—æ—¶æ˜¯å¦æ‰è½ç‰©å“',
            'doTraderSpawning': 'æ˜¯å¦ç”Ÿæˆæµæµªå•†äºº',
            'doWeatherCycle': 'æ˜¯å¦è¿›è¡Œå¤©æ°”å˜åŒ–',
            'drowningDamage': 'ç©å®¶æ˜¯å¦ä¼šå—åˆ°æººæ°´ä¼¤å®³',
            'fallDamage': 'ç©å®¶æ˜¯å¦ä¼šå—åˆ°æ‘”è½ä¼¤å®³',
            'fireDamage': 'ç©å®¶æ˜¯å¦ä¼šå—åˆ°ç«ç„°ä¼¤å®³',
            'forgiveDeadPlayers': 'ä¸­ç«‹ç”Ÿç‰©åœ¨ç›®æ ‡ç©å®¶æ­»äº¡åæ˜¯å¦åœæ­¢æ„¤æ€’',
            'freezeDamage': 'ç©å®¶åœ¨ç²‰æœ«é›ªä¸­æ˜¯å¦ä¼šå—åˆ°å†°å†»ä¼¤å®³',
            'keepInventory': 'æ­»äº¡åæ˜¯å¦ä¿ç•™ç‰©å“æ å’Œç»éªŒ',
            'logAdminCommands': 'æ˜¯å¦åœ¨æœåŠ¡å™¨æ—¥å¿—ä¸­è®°å½•ç®¡ç†å‘˜æ‰§è¡Œçš„å‘½ä»¤',
            'maxCommandChainLength': 'å‘½ä»¤æ–¹å—é“¾æ‰§è¡Œçš„æœ€å¤§é•¿åº¦',
            'maxEntityCramming': 'å®ä½“æŒ¤å‹ä¼¤å®³é˜ˆå€¼ï¼ˆåŒä½ç½®æœ€å¤šå®ä½“æ•°ï¼‰',
            'mobGriefing': 'ç”Ÿç‰©æ˜¯å¦ä¼šç ´ååœ°å½¢å’Œæ¡èµ·ç‰©å“',
            'naturalRegeneration': 'ç©å®¶é¥¥é¥¿å€¼æ»¡æ—¶æ˜¯å¦è‡ªç„¶å›å¤ç”Ÿå‘½å€¼',
            'playersSleepingPercentage': 'è·³è¿‡å¤œæ™šæ‰€éœ€çš„å…¥ç¡ç©å®¶ç™¾åˆ†æ¯”',
            'randomTickSpeed': 'éšæœºåˆ»é€Ÿåº¦ï¼ˆå½±å“ä½œç‰©ç”Ÿé•¿ã€æ ‘å¶è…çƒ‚ç­‰ï¼‰',
            'reducedDebugInfo': 'æ˜¯å¦å‡å°‘F3è°ƒè¯•å±å¹•æ˜¾ç¤ºçš„ä¿¡æ¯',
            'sendCommandFeedback': 'æ˜¯å¦æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œåé¦ˆ',
            'showDeathMessages': 'æ˜¯å¦åœ¨èŠå¤©æ æ˜¾ç¤ºç©å®¶æ­»äº¡ä¿¡æ¯',
            'spawnRadius': 'ç©å®¶æ­»äº¡åçš„é‡ç”Ÿä¿æŠ¤åŠå¾„',
            'spectatorsGenerateChunks': 'è§‚å¯Ÿè€…æ¨¡å¼çš„ç©å®¶æ˜¯å¦èƒ½å¤ŸåŠ è½½åŒºå—',
            'universalAnger': 'ä¸­ç«‹ç”Ÿç‰©æ˜¯å¦ä¼šå¯¹ä»»ä½•ç©å®¶æ„¤æ€’ï¼ˆè€Œä¸ä»…æ˜¯æ”»å‡»è€…ï¼‰',
            'allowEnteringNetherUsingPortals': 'æ˜¯å¦å…è®¸ç©å®¶é€šè¿‡ä¸‹ç•Œä¼ é€é—¨è¿›å…¥ä¸‹ç•Œ',
            'allowFireTicksAwayFromPlayer': 'æ˜¯å¦åœ¨ç©å®¶è¿œç¦»æ—¶ç»§ç»­è®¡ç®—ç«ç„°è”“å»¶',
            'blockExplosionDropDecay': 'æ–¹å—çˆ†ç‚¸æ—¶æ˜¯å¦æ ¹æ®çˆ†ç‚¸è·ç¦»è¡°å‡æ‰è½ç‰©',
            'commandBlocksEnabled': 'æ˜¯å¦å¯ç”¨å‘½ä»¤æ–¹å—',
            'commandModificationBlockLimit': 'å‘½ä»¤æ–¹å—é“¾ä¸­å•ä¸ªå‘½ä»¤å¯ä»¥ä¿®æ”¹çš„æœ€å¤§æ–¹å—æ•°é‡',
            'disablePlayerMovementCheck': 'æ˜¯å¦ç¦ç”¨ç©å®¶ç§»åŠ¨æ£€æŸ¥ï¼ˆå¯ç”¨äºåä½œå¼Šï¼‰',
            'doVinesSpread': 'è—¤è”“æ˜¯å¦ä¼šè‡ªç„¶è”“å»¶',
            'doWardenSpawning': 'æ˜¯å¦ç”Ÿæˆç›‘å®ˆè€…',
            'enderPearlsVanishOnDeath': 'ç©å®¶æ­»äº¡æ—¶æœ«å½±çç æ˜¯å¦ä¼šæ¶ˆå¤±',
            'globalSoundEvents': 'æ˜¯å¦å¯ç”¨å…¨å±€å£°éŸ³äº‹ä»¶',
            'lavaSourceConversion': 'æ˜¯å¦å…è®¸å²©æµ†æºæ–¹å—è½¬æ¢ï¼ˆå¦‚é»‘çŸ³ç”Ÿæˆï¼‰',
            'locatorBar': 'æ˜¯å¦æ˜¾ç¤ºå®šä½å™¨åœ°å›¾çš„è¿›åº¦æ¡',
            'maxCommandForkCount': 'å•ä¸ªå‘½ä»¤æ‰§è¡Œçš„æœ€å¤§åˆ†æ”¯æ•°é‡',
            'mobExplosionDropDecay': 'ç”Ÿç‰©çˆ†ç‚¸æ—¶æ˜¯å¦æ ¹æ®çˆ†ç‚¸è·ç¦»è¡°å‡æ‰è½ç‰©',
            'playersNetherPortalCreativeDelay': 'åˆ›é€ æ¨¡å¼ç©å®¶é€šè¿‡ä¸‹ç•Œä¼ é€é—¨çš„å†·å´æ—¶é—´ï¼ˆåˆ»ï¼‰',
            'playersNetherPortalDefaultDelay': 'ç”Ÿå­˜æ¨¡å¼ç©å®¶é€šè¿‡ä¸‹ç•Œä¼ é€é—¨çš„å†·å´æ—¶é—´ï¼ˆåˆ»ï¼‰',
            'projectilesCanBreakBlocks': 'æŠ›å°„ç‰©æ˜¯å¦å¯ä»¥ç ´åæ–¹å—',
            'pvp': 'æ˜¯å¦å…è®¸ç©å®¶ä¹‹é—´çš„æˆ˜æ–—ï¼ˆPvPï¼‰',
            'snowAccumulationHeight': 'é›ªå±‚ç§¯ç´¯çš„æœ€å¤§é«˜åº¦',
            'spawnMonsters': 'æ˜¯å¦è‡ªç„¶ç”Ÿæˆæ•Œå¯¹ç”Ÿç‰©',
            'spawnerBlocksEnabled': 'æ˜¯å¦å¯ç”¨åˆ·æ€ªç¬¼',
            'tntExplodes': 'TNTæ˜¯å¦ä¼šçˆ†ç‚¸',
            'tntExplosionDropDecay': 'TNTçˆ†ç‚¸æ—¶æ˜¯å¦æ ¹æ®çˆ†ç‚¸è·ç¦»è¡°å‡æ‰è½ç‰©',
            'waterSourceConversion': 'æ˜¯å¦å…è®¸æ°´æºæ–¹å—è½¬æ¢ï¼ˆå¦‚åœ†çŸ³å˜æˆè‹”çŸ³ï¼‰'
        };

        // é»˜è®¤å€¼æ˜ å°„
        const defaultValues = {
            'announceAdvancements': "true",
            'commandBlockOutput': "true",
            'disableElytraMovementCheck': "false",
            'disableRaids': "false",
            'doDaylightCycle': "true",
            'doEntityDrops': "true",
            'doFireTick': "true",
            'doImmediateRespawn': "false",
            'doInsomnia': "true",
            'doLimitedCrafting': "false",
            'doMobLoot': "true",
            'doMobSpawning': "true",
            'doPatrolSpawning': "true",
            'doTileDrops': "true",
            'doTraderSpawning': "true",
            'doWeatherCycle': "true",
            'drowningDamage': "true",
            'fallDamage': "true",
            'fireDamage': "true",
            'forgiveDeadPlayers': "true",
            'freezeDamage': "true",
            'keepInventory': "false",
            'logAdminCommands': "true",
            'maxCommandChainLength': "65536",
            'maxEntityCramming': "24",
            'mobGriefing': "true",
            'naturalRegeneration': "true",
            'playersSleepingPercentage': "100",
            'randomTickSpeed': "3",
            'reducedDebugInfo': "false",
            'sendCommandFeedback': "true",
            'showDeathMessages': "true",
            'spawnRadius': "10",
            'spectatorsGenerateChunks': "true",
            'universalAnger': "false",
            'allowEnteringNetherUsingPortals': "true",
            'allowFireTicksAwayFromPlayer': "false",
            'blockExplosionDropDecay': "true",
            'commandBlocksEnabled': "true",
            'commandModificationBlockLimit': "32768",
            'disablePlayerMovementCheck': "false",
            'doVinesSpread': "true",
            'doWardenSpawning': "true",
            'enderPearlsVanishOnDeath': "true",
            'globalSoundEvents': "true",
            'lavaSourceConversion': "false",
            'locatorBar': "true",
            'maxCommandForkCount': "65536",
            'mobExplosionDropDecay': "true",
            'playersNetherPortalCreativeDelay': "0",
            'playersNetherPortalDefaultDelay': "80",
            'projectilesCanBreakBlocks': "true",
            'pvp': "true",
            'snowAccumulationHeight': "1",
            'spawnMonsters': "true",
            'spawnerBlocksEnabled': "true",
            'tntExplodes': "true",
            'tntExplosionDropDecay': "false",
            'waterSourceConversion': "true"
        };

        let currentRules = [];

        // ç™»å½•åŠŸèƒ½
        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            // è¾“å…¥éªŒè¯
            if (!SecurityUtils.validateUsername(username)) {
                errorDiv.textContent = 'ç”¨æˆ·åæ ¼å¼æ— æ•ˆï¼ˆåªå…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦ï¼‰';
                errorDiv.style.display = 'block';
                return;
            }

            if (!password || password.length < 8) {
                errorDiv.textContent = 'å¯†ç é•¿åº¦è‡³å°‘8ä½';
                errorDiv.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        username: SecurityUtils.sanitizeInput(username), 
                        password: SecurityUtils.sanitizeInput(password) 
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    sessionId = result.session;
                    // å®‰å…¨åœ°å­˜å‚¨ä¼šè¯ID
                    localStorage.setItem('mc_session', sessionId);
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('mainInterface').style.display = 'block';
                    errorDiv.style.display = 'none';
                    addLog('âœ… ç™»å½•æˆåŠŸ', 'success');
                    
                    // å¼€å§‹çŠ¶æ€è½®è¯¢
                    startStatusPolling();
                } else {
                    errorDiv.textContent = SecurityUtils.sanitizeInput(result.message) || 'ç™»å½•å¤±è´¥';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'ç™»å½•è¯·æ±‚å¤±è´¥: ' + SecurityUtils.sanitizeInput(error.message);
                errorDiv.style.display = 'block';
                console.error('Login error:', error);
            }
        }

        // æ£€æŸ¥è®¤è¯çŠ¶æ€
        async function checkAuth() {
            if (!sessionId) {
                alert('è¯·å…ˆç™»å½•');
                return false;
            }
            
            try {
                const response = await fetch('/api/check', {
                    headers: {
                        'X-Session-ID': sessionId
                    }
                });
                
                const result = await response.json();
                return result.success;
            } catch (error) {
                console.error('Auth check failed:', error);
                return false;
            }
        }

        // é€€å‡ºç™»å½•
        function logout() {
            // è°ƒç”¨é€€å‡ºæ¥å£
            if (sessionId) {
                fetch('/api/logout', {
                    method: 'POST',
                    headers: {
                        'X-Session-ID': sessionId
                    }
                }).catch(console.error);
            }
            
            sessionId = null;
            // æ¸…é™¤æœ¬åœ°å­˜å‚¨
            localStorage.removeItem('mc_session');
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('mainInterface').style.display = 'none';
            
            // åœæ­¢çŠ¶æ€è½®è¯¢
            stopStatusPolling();
            
            if (ws) {
                disconnect();
            }
            addLog('å·²å®‰å…¨é€€å‡ºç™»å½•', 'info');
        }

        // å¼€å§‹çŠ¶æ€è½®è¯¢
        function startStatusPolling() {
            if (statusPollInterval) {
                clearInterval(statusPollInterval);
            }
            
            statusPollInterval = setInterval(() => {
                if (sessionId) {
                    checkServerStatus();
                    // æ¯60ç§’æ£€æŸ¥ä¸€æ¬¡RCONçŠ¶æ€
                    if (Date.now() % 60000 < 1000) {
                        checkRconStatus();
                    }
                }
            }, 10000); // æ¯40ç§’æ£€æŸ¥ä¸€æ¬¡æœåŠ¡å™¨çŠ¶æ€
        }

        // åœæ­¢çŠ¶æ€è½®è¯¢
        function stopStatusPolling() {
            if (statusPollInterval) {
                clearInterval(statusPollInterval);
                statusPollInterval = null;
            }
        }

        // è¿æ¥æœåŠ¡å™¨è¾“å‡ºæµ
        function connectServerOutput() {
            if (serverOutputWs && serverOutputWs.readyState === WebSocket.OPEN) {
                return;
            }
            
            const host = document.getElementById('wsHost').value;
            const port = document.getElementById('wsPort').value;
            
            try {
                serverOutputWs = new WebSocket(`ws://${host}:${port}/server_output`);
                
                serverOutputWs.onopen = function() {
                    addLog('âœ… å·²è¿æ¥åˆ°æœåŠ¡å™¨è¾“å‡ºæµ', 'success');
                };
                
                serverOutputWs.onclose = function() {
                    addLog('âŒ æœåŠ¡å™¨è¾“å‡ºæµè¿æ¥å·²æ–­å¼€', 'error');
                };
                
                serverOutputWs.onerror = function(error) {
                    addLog('âŒ æœåŠ¡å™¨è¾“å‡ºæµè¿æ¥é”™è¯¯', 'error');
                    console.error('Server output WebSocket error:', error);
                };
                
                serverOutputWs.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        if (data.type === 'server_output') {
                            // åœ¨æ§åˆ¶å°æ—¥å¿—ä¸­æ˜¾ç¤ºæœåŠ¡å™¨è¾“å‡º
                            addLog(data.data, 'info');
                        }
                    } catch (e) {
                        console.log('æ”¶åˆ°éJSONæ¶ˆæ¯:', event.data);
                    }
                };
                
            } catch (error) {
                addLog('âŒ è¿æ¥æœåŠ¡å™¨è¾“å‡ºæµå¤±è´¥: ' + error.message, 'error');
                console.error('Server output connection error:', error);
            }
        }

        // è¿æ¥ WebSocket
        function connect() {
            if (!sessionId) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const host = document.getElementById('wsHost').value;
            const port = document.getElementById('wsPort').value;
            
            // éªŒè¯ä¸»æœºåå’Œç«¯å£
            if (!host || !port) {
                addLog('âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„ä¸»æœºåå’Œç«¯å£', 'error');
                return;
            }
            
            updateStatus('connecting', 'è¿æ¥ä¸­...');
            
            try {
                ws = new WebSocket(`ws://${SecurityUtils.sanitizeInput(host)}:${SecurityUtils.sanitizeInput(port)}`);
                
                ws.onopen = function() {
                    updateStatus('connected', 'å·²è¿æ¥');
                    isConnected = true;
                    document.getElementById('connectBtn').disabled = true;
                    document.getElementById('disconnectBtn').disabled = false;
                    addLog('âœ… å·²è¿æ¥åˆ° Minecraft æœåŠ¡å™¨', 'success');
                    
                    // è¿æ¥æœåŠ¡å™¨è¾“å‡ºæµ
                    connectServerOutput();
                    
                    // è¿æ¥æˆåŠŸåè·å–åˆå§‹æ•°æ®
                    setTimeout(() => {
                        getPlayers();
                        getWhitelist();
                        getWhitelistStatus();
                        getBans();
                        getIPBans();
                        getAdmins();
                        getGameRules();
                        checkRconStatus();
                    }, 1000);
                    setTimeout(() => {
                        checkServerStatus();
                    }, 1500);
                };
                
                ws.onclose = function() {
                    updateStatus('disconnected', 'è¿æ¥æ–­å¼€');
                    isConnected = false;
                    document.getElementById('connectBtn').disabled = false;
                    document.getElementById('disconnectBtn').disabled = true;
                    addLog('âŒ ä¸æœåŠ¡å™¨çš„è¿æ¥å·²æ–­å¼€', 'error');
                };
                
                ws.onerror = function(error) {
                    updateStatus('disconnected', 'è¿æ¥é”™è¯¯');
                    addLog('âŒ è¿æ¥é”™è¯¯', 'error');
                    console.error('WebSocket error:', error);
                };
                
                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        handleServerMessage(data);
                    } catch (e) {
                        console.log('æ”¶åˆ°éJSONæ¶ˆæ¯:', event.data);
                    }
                };
                
            } catch (error) {
                updateStatus('disconnected', 'è¿æ¥å¤±è´¥');
                addLog('âŒ è¿æ¥å¤±è´¥: ' + SecurityUtils.sanitizeInput(error.message), 'error');
                console.error('Connection error:', error);
            }
        }

        // æ–­å¼€è¿æ¥
        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
            
            if (serverOutputWs) {
                serverOutputWs.close();
                serverOutputWs = null;
            }
            
            updateStatus('disconnected', 'æœªè¿æ¥');
            document.getElementById('connectBtn').disabled = false;
            document.getElementById('disconnectBtn').disabled = true;
            addLog('å·²æ–­å¼€è¿æ¥', 'info');
            
            // æ–­å¼€è¿æ¥æ—¶æ›´æ–° RCON çŠ¶æ€
            rconEnabled = false;
            updateRconStatusDisplay();
        }

        // æ›´æ–°è¿æ¥çŠ¶æ€
        function updateStatus(status, text) {
            const indicator = document.getElementById('statusIndicator');
            indicator.className = `status ${status}`;
            indicator.querySelector('.status-text').textContent = text;
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            // æ¸…ç†è¾“å‡ºå†…å®¹
            const safeMessage = SecurityUtils.sanitizeInput(message);
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${safeMessage}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // æ·»åŠ äº‹ä»¶
        function addEvent(type, data) {
            const eventsContainer = document.getElementById('eventsContainer');
            const eventItem = document.createElement('div');
            eventItem.className = 'event-item';
            
            const timestamp = new Date().toLocaleTimeString();
            eventItem.innerHTML = `
                <div class="event-time">${timestamp}</div>
                <div class="event-type">${type}</div>
                <div class="event-data">${JSON.stringify(data, null, 2)}</div>
            `;
            
            eventsContainer.appendChild(eventItem);
            eventsContainer.scrollTop = eventsContainer.scrollHeight;
            
            // é™åˆ¶äº‹ä»¶æ•°é‡
            const events = eventsContainer.querySelectorAll('.event-item');
            if (events.length > 50) {
                events[0].remove();
            }
        }

        // æ£€æŸ¥ RCON çŠ¶æ€
        async function checkRconStatus() {
            try {
                const response = await fetch('/api/rcon', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId
                    },
                    body: JSON.stringify({ command: 'list' })
                });
                
                const result = await response.json();
                rconEnabled = result.success;
                updateRconStatusDisplay();
                
            } catch (error) {
                rconEnabled = false;
                updateRconStatusDisplay();
            }
        }

        // æ›´æ–° RCON çŠ¶æ€æ˜¾ç¤º
        function updateRconStatusDisplay() {
            const indicator = document.getElementById('rconStatusIndicator');
            const statusText = document.getElementById('rconStatusText');
            
            if (rconEnabled) {
                indicator.className = 'rcon-indicator on';
                statusText.textContent = 'RCON çŠ¶æ€: å·²è¿æ¥';
            } else {
                indicator.className = 'rcon-indicator off';
                statusText.textContent = 'RCON çŠ¶æ€: æœªè¿æ¥';
            }
        }

        // æ‰§è¡Œ RCON å‘½ä»¤
        async function executeRconCommand() {
            const commandInput = document.getElementById('commandInput');
            const command = commandInput.value.trim();
            
            if (!command) return;
            
            if (!rconEnabled) {
                addLog('âŒ RCON æœªå¯ç”¨ï¼Œæ— æ³•æ‰§è¡Œå‘½ä»¤', 'error');
                return;
            }
            
            addLog(`ğŸ”„ æ‰§è¡Œå‘½ä»¤: ${command}`, 'info');
            
            try {
                const response = await fetch('/api/rcon', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId
                    },
                    body: JSON.stringify({ command: command })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog(`âœ… å‘½ä»¤æ‰§è¡ŒæˆåŠŸ: ${result.response}`, 'success');
                } else {
                    addLog(`âŒ å‘½ä»¤æ‰§è¡Œå¤±è´¥: ${result.message}`, 'error');
                }
                
                commandInput.value = '';
            } catch (error) {
                addLog(`âŒ å‘½ä»¤æ‰§è¡Œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        // å¤„ç†å‘½ä»¤è¾“å…¥æ¡†å›è½¦é”®
        function handleCommandKeypress(event) {
            if (event.key === 'Enter') {
                executeRconCommand();
            }
        }

        // å‘é€ RPC è¯·æ±‚ï¼ˆä¿æŒåŸæœ‰åè®®æ ¼å¼ï¼‰
        function sendRequest(method, params = []) {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addLog('âŒ æœªè¿æ¥åˆ°æœåŠ¡å™¨', 'error');
                return Promise.reject(new Error('æœªè¿æ¥'));
            }
            
            const id = requestId++;
            const request = {
                jsonrpc: "2.0",
                method: method,
                params: params,
                id: id
            };
            
            return new Promise((resolve, reject) => {
                pendingRequests[id] = { resolve, reject };
                const jsonStr = JSON.stringify(request);
                console.log('å‘é€è¯·æ±‚:', jsonStr);
                ws.send(jsonStr);
                addLog(`å‘é€è¯·æ±‚: ${method}`, 'info');
                
                // è®¾ç½®è¶…æ—¶
                setTimeout(() => {
                    if (pendingRequests[id]) {
                        delete pendingRequests[id];
                        reject(new Error('è¯·æ±‚è¶…æ—¶'));
                        addLog(`è¯·æ±‚è¶…æ—¶: ${method}`, 'error');
                    }
                }, 10000);
            });
        }

        // å¤„ç†æœåŠ¡å™¨æ¶ˆæ¯
        function handleServerMessage(data) {
            console.log('æ”¶åˆ°æ¶ˆæ¯:', data);
            
            if (data.id && pendingRequests[data.id]) {
                const { resolve, reject } = pendingRequests[data.id];
                delete pendingRequests[data.id];
                
                if (data.error) {
                    addLog(`é”™è¯¯ [${data.error.code}]: ${data.error.message}`, 'error');
                    reject(data.error);
                } else {
                    addLog(`æ”¶åˆ°å“åº”`, 'success');
                    resolve(data.result);
                }
            } else if (data.method) {
                // å¤„ç†æœåŠ¡å™¨æ¨é€çš„äº‹ä»¶
                addEvent(data.method, data.params);
                addLog(`æ”¶åˆ°äº‹ä»¶: ${data.method}`, 'info');
                
                // å¤„ç†ç‰¹å®šäº‹ä»¶
                switch (data.method) {
                    case 'minecraft:notification/players/joined':
                        if (data.params && data.params[0]) {
                            addLog(`ğŸ® ç©å®¶ ${data.params[0].name} åŠ å…¥äº†æ¸¸æˆ`, 'success');
                            getPlayers();
                        }
                        break;
                    case 'minecraft:notification/players/left':
                        if (data.params && data.params[0]) {
                            addLog(`ğŸšª ç©å®¶ ${data.params[0].name} ç¦»å¼€äº†æ¸¸æˆ`, 'warning');
                            getPlayers();
                        }
                        break;
                    case 'minecraft:notification/server/saving':
                        addLog('ğŸ’¾ æœåŠ¡å™¨æ­£åœ¨ä¿å­˜ä¸–ç•Œ...', 'warning');
                        break;
                    case 'minecraft:notification/server/saved':
                        addLog('âœ… ä¸–ç•Œä¿å­˜å®Œæˆ', 'success');
                        break;
                }
            }
        }

        // è·å–åœ¨çº¿ç©å®¶
        function getPlayers() {
            sendRequest('players', [])
                .then(players => {
                    displayPlayers(players);
                    addLog(`è·å–åˆ° ${players.length} ååœ¨çº¿ç©å®¶`, 'success');
                })
                .catch(error => {
                    addLog('è·å–ç©å®¶åˆ—è¡¨å¤±è´¥: ' + error.message, 'error');
                });
        }

        // æ˜¾ç¤ºç©å®¶åˆ—è¡¨ - ä½¿ç”¨ç´§å‡‘æ ·å¼
        function displayPlayers(players) {
            const playersList = document.getElementById('playersList');
            
            if (!players || players.length === 0) {
                playersList.innerHTML = '<li class="empty-state">æ²¡æœ‰åœ¨çº¿ç©å®¶</li>';
                return;
            }
            
            playersList.innerHTML = players.map(player => `
                <li class="compact-player-item" data-name="${player.name.toLowerCase()}">
                    <div class="compact-player-info">
                        <div class="compact-player-name">${player.name}</div>
                        <div class="compact-player-uuid">${player.id}</div>
                    </div>
                    <div class="compact-player-actions">
                        <button class="btn btn-danger btn-small" onclick="kickPlayer('${player.name}', '${player.id}')">è¸¢å‡º</button>
                    </div>
                </li>
            `).join('');
        }

        // ç­›é€‰ç©å®¶
        function filterPlayers() {
            const search = document.getElementById('playersSearch').value.toLowerCase();
            const items = document.querySelectorAll('#playersList .compact-player-item');
            
            items.forEach(item => {
                const playerName = item.getAttribute('data-name');
                if (playerName.includes(search)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // è¸¢å‡ºç©å®¶
        function kickPlayer(playerName, playerId) {
            if (!confirm(`ç¡®å®šè¦è¸¢å‡ºç©å®¶ ${playerName} å—ï¼Ÿ`)) return;
            
            const kickParams = {
                message: "æ‚¨å·²è¢«ç®¡ç†å‘˜è¸¢å‡ºæœåŠ¡å™¨",
                player: [{ 
                    name: playerName, 
                    id: playerId 
                }]
            };
            
            addLog(`ğŸ”„ æ­£åœ¨è¸¢å‡ºç©å®¶: ${playerName}`, 'info');
            
            sendRequest('players/kick', [kickParams])
            .then((kickedPlayers) => {
                if (kickedPlayers && kickedPlayers.length > 0) {
                    addLog(`âœ… å·²æˆåŠŸè¸¢å‡ºç©å®¶: ${playerName}`, 'success');
                } else {
                    addLog(`âš ï¸ ç©å®¶ ${playerName} å¯èƒ½ä¸åœ¨çº¿`, 'warning');
                }
                // ç«‹å³åˆ·æ–°ç©å®¶åˆ—è¡¨
                setTimeout(() => getPlayers(), 1000);
            })
            .catch(error => {
                let errorMsg = error.message;
                if (error.code === -32602) {
                    errorMsg = "å‚æ•°æ ¼å¼é”™è¯¯";
                } else if (error.code === -32601) {
                    errorMsg = "æ–¹æ³•ä¸å­˜åœ¨";
                }
                addLog(`âŒ è¸¢å‡ºç©å®¶å¤±è´¥: ${playerName} - ${errorMsg}`, 'error');
            });
        }

        // ä¿å­˜ä¸–ç•Œ
        function saveAll() {
            sendRequest('server/save', [true])
                .then(() => {
                    addLog('ä¸–ç•Œå·²ä¿å­˜', 'success');
                })
                .catch(error => {
                    addLog('ä¿å­˜ä¸–ç•Œå¤±è´¥: ' + error.message, 'error');
                });
        }

        // åœæ­¢æœåŠ¡å™¨
        function stopServer() {
            if (!confirm('ç¡®å®šè¦åœæ­¢æœåŠ¡å™¨å—ï¼Ÿè¿™å°†æ–­å¼€æ‰€æœ‰ç©å®¶è¿æ¥ï¼')) return;
            
            sendRequest('server/stop', [])
                .then(() => {
                    addLog('æœåŠ¡å™¨æ­£åœ¨å…³é—­...', 'warning');
                    // åœæ­¢åå»¶è¿Ÿæ£€æŸ¥çŠ¶æ€
                    setTimeout(() => {
                        checkServerStatus();
                        checkRconStatus();
                    }, 3000);
                })
                .catch(error => {
                    addLog('åœæ­¢æœåŠ¡å™¨å¤±è´¥: ' + error.message, 'error');
                });
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            addLog('æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        // æ¸…ç©ºäº‹ä»¶
        function clearEvents() {
            document.getElementById('eventsContainer').innerHTML = '<div class="empty-state">æœåŠ¡å™¨äº‹ä»¶å°†åœ¨è¿™é‡Œæ˜¾ç¤º</div>';
        }

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // å–æ¶ˆæ‰€æœ‰æ ‡ç­¾æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
        }

        // ç™½åå•åŠŸèƒ½
        function getWhitelistStatus() {
            sendRequest('serversettings/use_allowlist', [])
                .then(result => {
                    whitelistEnabled = result;
                    updateWhitelistStatusDisplay();
                    addLog(`ç™½åå•çŠ¶æ€: ${whitelistEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}`, 'success');
                })
                .catch(error => {
                    addLog('è·å–ç™½åå•çŠ¶æ€å¤±è´¥: ' + error.message, 'error');
                });
        }

        function updateWhitelistStatusDisplay() {
            const indicator = document.getElementById('whitelistStatusIndicator');
            const statusText = document.getElementById('whitelistStatusText');
            const enableBtn = document.getElementById('enableWhitelistBtn');
            const disableBtn = document.getElementById('disableWhitelistBtn');
            
            if (whitelistEnabled) {
                indicator.className = 'status-indicator on';
                statusText.textContent = 'ç™½åå•å·²å¯ç”¨';
                enableBtn.disabled = true;
                disableBtn.disabled = false;
                enableBtn.innerHTML = 'âœ… å·²å¯ç”¨';
                disableBtn.innerHTML = 'âŒ å…³é—­ç™½åå•';
            } else {
                indicator.className = 'status-indicator off';
                statusText.textContent = 'ç™½åå•å·²ç¦ç”¨';
                enableBtn.disabled = false;
                disableBtn.disabled = true;
                enableBtn.innerHTML = 'âœ… å¯ç”¨ç™½åå•';
                disableBtn.innerHTML = 'âŒ å·²å…³é—­';
            }
        }

        function toggleWhitelist(enable) {
            sendRequest('serversettings/use_allowlist/set', [enable])
                .then(() => {
                    whitelistEnabled = enable;
                    updateWhitelistStatusDisplay();
                    addLog(`ç™½åå•å·²${enable ? 'å¯ç”¨' : 'å…³é—­'}`, 'success');
                })
                .catch(error => {
                    addLog(`${enable ? 'å¯ç”¨' : 'å…³é—­'}ç™½åå•å¤±è´¥: ${error.message}`, 'error');
                });
        }

        function getWhitelist() {
            sendRequest('allowlist', [])
                .then(whitelist => {
                    displayWhitelist(whitelist);
                    addLog(`è·å–åˆ° ${whitelist.length} ä¸ªç™½åå•ç©å®¶`, 'success');
                })
                .catch(error => {
                    addLog('è·å–ç™½åå•å¤±è´¥: ' + error.message, 'error');
                });
        }

        function displayWhitelist(whitelist) {
            const container = document.getElementById('whitelistContainer');
            
            if (!whitelist || whitelist.length === 0) {
                container.innerHTML = '<div class="empty-state">ç™½åå•ä¸ºç©º</div>';
                return;
            }
            
            container.innerHTML = whitelist.map(player => `
                <div class="compact-player-item" data-name="${player.name.toLowerCase()}">
                    <div class="compact-player-info">
                        <div class="compact-player-name">âœ“ ${player.name}</div>
                        <div class="compact-player-uuid">${player.id}</div>
                    </div>
                    <div class="compact-player-actions">
                        <button class="btn btn-danger btn-small" onclick="removeFromWhitelist('${player.name}', '${player.id}')">ç§»é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function addToWhitelist() {
            const playerName = document.getElementById('addWhitelistPlayer').value.trim();
            if (!playerName) {
                alert('è¯·è¾“å…¥ç©å®¶åç§°');
                return;
            }
            
            sendRequest('allowlist/add', [[{ name: playerName }]])
                .then(() => {
                    addLog(`å·²å°† ${playerName} æ·»åŠ åˆ°ç™½åå•`, 'success');
                    document.getElementById('addWhitelistPlayer').value = '';
                    getWhitelist();
                })
                .catch(error => {
                    addLog(`æ·»åŠ ç™½åå•å¤±è´¥: ${playerName} - ${error.message}`, 'error');
                });
        }

        function removeFromWhitelist(playerName, playerId) {
            if (!confirm(`ç¡®å®šè¦ä»ç™½åå•ç§»é™¤ ${playerName} å—ï¼Ÿ`)) return;
            
            sendRequest('allowlist/remove', [[{ name: playerName, id: playerId }]])
                .then(() => {
                    addLog(`å·²ä»ç™½åå•ç§»é™¤: ${playerName}`, 'success');
                    getWhitelist();
                })
                .catch(error => {
                    addLog(`ç§»é™¤ç™½åå•å¤±è´¥: ${playerName} - ${error.message}`, 'error');
                });
        }

        function filterWhitelist() {
            const search = document.getElementById('whitelistSearch').value.toLowerCase();
            const items = document.querySelectorAll('#whitelistContainer .compact-player-item');
            
            items.forEach(item => {
                const playerName = item.getAttribute('data-name');
                if (playerName.includes(search)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // å°ç¦ç®¡ç†åŠŸèƒ½
        function getBans() {
            sendRequest('bans', [])
                .then(bans => {
                    displayBans(bans);
                    addLog(`è·å–åˆ° ${bans.length} ä¸ªç©å®¶å°ç¦`, 'success');
                })
                .catch(error => {
                    addLog('è·å–å°ç¦åˆ—è¡¨å¤±è´¥: ' + error.message, 'error');
                });
        }

        function getIPBans() {
            sendRequest('ip_bans', [])
                .then(ipBans => {
                    displayIPBans(ipBans);
                    addLog(`è·å–åˆ° ${ipBans.length} ä¸ªIPå°ç¦`, 'success');
                })
                .catch(error => {
                    addLog('è·å–IPå°ç¦åˆ—è¡¨å¤±è´¥: ' + error.message, 'error');
                });
        }

        function displayBans(bans) {
            const container = document.getElementById('bansContainer');
            
            if (!bans || bans.length === 0) {
                container.innerHTML = '<div class="empty-state">ç©å®¶å°ç¦åˆ—è¡¨ä¸ºç©º</div>';
                return;
            }
            
            const bansHTML = bans.map(ban => `
                <div class="compact-player-item" data-name="${ban.player.name.toLowerCase()}">
                    <div class="compact-player-info">
                        <div class="compact-player-name">ğŸš« ${ban.player.name}</div>
                        <div class="compact-player-uuid">${ban.player.id}</div>
                        ${ban.reason ? `<div style="color: var(--danger); font-size: 0.7rem; margin-top: 2px;">åŸå› : ${ban.reason}</div>` : ''}
                        ${ban.source ? `<div style="color: #888; font-size: 0.6rem; margin-top: 1px;">æ“ä½œè€…: ${ban.source}</div>` : ''}
                    </div>
                    <div class="compact-player-actions">
                        <button class="btn btn-success btn-small" onclick="unbanPlayer('${ban.player.name}', '${ban.player.id}')">è§£å°</button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = '<h4 style="margin-bottom: 10px; color: var(--dark);">ç©å®¶å°ç¦åˆ—è¡¨</h4>' + bansHTML;
        }

        function displayIPBans(ipBans) {
            const container = document.getElementById('bansContainer');
            let existingContent = container.innerHTML;
            
            if (!ipBans || ipBans.length === 0) {
                container.innerHTML = existingContent + '<h4 style="margin-top: 15px; color: var(--dark);">IPå°ç¦åˆ—è¡¨</h4><div class="empty-state">IPå°ç¦åˆ—è¡¨ä¸ºç©º</div>';
                return;
            }
            
            const ipBansHTML = ipBans.map(ban => `
                <div class="compact-player-item" data-ip="${ban.ip}">
                    <div class="compact-player-info">
                        <div class="compact-player-name">ğŸŒ ${ban.ip}</div>
                        ${ban.reason ? `<div style="color: var(--danger); font-size: 0.7rem; margin-top: 2px;">åŸå› : ${ban.reason}</div>` : ''}
                        ${ban.source ? `<div style="color: #888; font-size: 0.6rem; margin-top: 1px;">æ“ä½œè€…: ${ban.source}</div>` : ''}
                    </div>
                    <div class="compact-player-actions">
                        <button class="btn btn-success btn-small" onclick="unbanIP('${ban.ip}')">è§£å°</button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = existingContent + '<h4 style="margin-top: 15px; color: var(--dark);">IPå°ç¦åˆ—è¡¨</h4>' + ipBansHTML;
        }

        function banPlayer() {
            const playerName = document.getElementById('banPlayerName').value.trim();
            const reason = document.getElementById('banReason').value.trim();
            
            if (!playerName) {
                alert('è¯·è¾“å…¥ç©å®¶åç§°');
                return;
            }
            
            if (!confirm(`ç¡®å®šè¦å°ç¦ç©å®¶ ${playerName} å—ï¼Ÿ`)) return;
            
            sendRequest('bans/add', [[{
                player: { name: playerName },
                reason: reason || "è¿åæœåŠ¡å™¨è§„åˆ™",
                source: "ç®¡ç†é¢æ¿"
            }]])
                .then(() => {
                    addLog(`å·²å°ç¦ç©å®¶: ${playerName}`, 'success');
                    document.getElementById('banPlayerName').value = '';
                    document.getElementById('banReason').value = '';
                    getBans();
                })
                .catch(error => {
                    addLog(`å°ç¦ç©å®¶å¤±è´¥: ${playerName} - ${error.message}`, 'error');
                });
        }

        function banIP() {
            const ip = document.getElementById('banIP').value.trim();
            const reason = document.getElementById('banIPReason').value.trim();
            
            if (!ip) {
                alert('è¯·è¾“å…¥IPåœ°å€');
                return;
            }
            
            if (!confirm(`ç¡®å®šè¦å°ç¦IP ${ip} å—ï¼Ÿ`)) return;
            
            sendRequest('ip_bans/add', [[{
                ip: ip,
                reason: reason || "è¿åæœåŠ¡å™¨è§„åˆ™",
                source: "ç®¡ç†é¢æ¿"
            }]])
                .then(() => {
                    addLog(`å·²å°ç¦IP: ${ip}`, 'success');
                    document.getElementById('banIP').value = '';
                    document.getElementById('banIPReason').value = '';
                    getIPBans();
                })
                .catch(error => {
                    addLog(`å°ç¦IPå¤±è´¥: ${ip} - ${error.message}`, 'error');
                });
        }

        function unbanPlayer(playerName, playerId) {
            if (!confirm(`ç¡®å®šè¦è§£å° ${playerName} å—ï¼Ÿ`)) return;
            
            sendRequest('bans/remove', [[{ name: playerName, id: playerId }]])
                .then(() => {
                    addLog(`å·²è§£å°ç©å®¶: ${playerName}`, 'success');
                    getBans();
                })
                .catch(error => {
                    addLog(`è§£å°ç©å®¶å¤±è´¥: ${playerName} - ${error.message}`, 'error');
                });
        }

        function unbanIP(ip) {
            if (!confirm(`ç¡®å®šè¦è§£å°IP ${ip} å—ï¼Ÿ`)) return;
            
            sendRequest('ip_bans/remove', [[ip]])
                .then(() => {
                    addLog(`å·²è§£å°IP: ${ip}`, 'success');
                    getIPBans();
                })
                .catch(error => {
                    addLog(`è§£å°IPå¤±è´¥: ${ip} - ${error.message}`, 'error');
                });
        }

        function filterBans() {
            const search = document.getElementById('bansSearch').value.toLowerCase();
            const items = document.querySelectorAll('#bansContainer .compact-player-item');
            
            items.forEach(item => {
                const name = item.getAttribute('data-name');
                const ip = item.getAttribute('data-ip');
                const searchText = (name || ip || '').toLowerCase();
                
                if (searchText.includes(search)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // ç®¡ç†å‘˜ç®¡ç†åŠŸèƒ½
        function getAdmins() {
            sendRequest('operators', [])
                .then(admins => {
                    displayAdmins(admins);
                    addLog(`è·å–åˆ° ${admins.length} åç®¡ç†å‘˜`, 'success');
                })
                .catch(error => {
                    addLog('è·å–ç®¡ç†å‘˜åˆ—è¡¨å¤±è´¥: ' + error.message, 'error');
                });
        }

        function displayAdmins(admins) {
            const container = document.getElementById('adminsContainer');
            
            if (!admins || admins.length === 0) {
                container.innerHTML = '<div class="empty-state">æš‚æ— ç®¡ç†å‘˜</div>';
                return;
            }
            
            container.innerHTML = admins.map(admin => `
                <div class="compact-player-item" data-name="${admin.player.name.toLowerCase()}">
                    <div class="compact-player-info">
                        <div class="compact-player-name">ğŸ‘‘ ${admin.player.name}</div>
                        <div class="compact-player-uuid">${admin.player.id}</div>
                        <div style="color: #666; font-size: 0.7rem;">æƒé™ç­‰çº§: ${admin.permissionLevel}</div>
                    </div>
                    <div class="compact-player-actions">
                        <button class="btn btn-danger btn-small" onclick="removeAdmin('${admin.player.name}', '${admin.player.id}')">ç§»é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function addAdmin() {
            const playerName = document.getElementById('addAdminPlayer').value.trim();
            const level = parseInt(document.getElementById('adminLevel').value);
            
            if (!playerName) {
                alert('è¯·è¾“å…¥ç©å®¶åç§°');
                return;
            }
            
            if (isNaN(level) || level < 0 || level > 4) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æƒé™ç­‰çº§ (0-4)');
                return;
            }
            
            sendRequest('operators/add', [[{
                player: { name: playerName },
                permissionLevel: level,
                bypassesPlayerLimit: true
            }]])
                .then(() => {
                    addLog(`å·²å°† ${playerName} è®¾ç½®ä¸ºç®¡ç†å‘˜`, 'success');
                    document.getElementById('addAdminPlayer').value = '';
                    getAdmins();
                })
                .catch(error => {
                    addLog(`è®¾ç½®ç®¡ç†å‘˜å¤±è´¥: ${playerName} - ${error.message}`, 'error');
                });
        }

        function removeAdmin(playerName, playerId) {
            if (!confirm(`ç¡®å®šè¦ç§»é™¤ç®¡ç†å‘˜ ${playerName} å—ï¼Ÿ`)) return;
            
            sendRequest('operators/remove', [[{ name: playerName, id: playerId }]])
                .then(() => {
                    addLog(`å·²ç§»é™¤ç®¡ç†å‘˜: ${playerName}`, 'success');
                    getAdmins();
                })
                .catch(error => {
                    addLog(`ç§»é™¤ç®¡ç†å‘˜å¤±è´¥: ${playerName} - ${error.message}`, 'error');
                });
        }

        function filterAdmins() {
            const search = document.getElementById('adminsSearch').value.toLowerCase();
            const items = document.querySelectorAll('#adminsContainer .compact-player-item');
            
            items.forEach(item => {
                const playerName = item.getAttribute('data-name');
                if (playerName.includes(search)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // æ¸¸æˆè§„åˆ™ç®¡ç†åŠŸèƒ½
        function getGameRules() {
            sendRequest('gamerules', [])
                .then(result => {
                    currentRules = result;
                    displayGameRules(result);
                    addLog(`âœ… è·å–åˆ° ${result.length} æ¡æ¸¸æˆè§„åˆ™`, 'success');
                })
                .catch((error) => {
                    addLog('âŒ è·å–æ¸¸æˆè§„åˆ™å¤±è´¥: ' + error.message, 'error');
                    displayGameRules([]);
                });
        }

        function displayGameRules(gamerules) {
            const container = document.getElementById('gameRulesList');
            
            if (gamerules.length === 0) {
                container.innerHTML = '<div class="empty-state">æ²¡æœ‰æ¸¸æˆè§„åˆ™</div>';
                return;
            }

            // æŒ‰åˆ†ç±»åˆ†ç»„
            const categorizedRules = {};
            gamerules.forEach(rule => {
                const category = ruleCategories[rule.key] || 'other';
                if (!categorizedRules[category]) {
                    categorizedRules[category] = [];
                }
                categorizedRules[category].push(rule);
            });

            let html = '';
            
            // æ˜¾ç¤ºå„ä¸ªåˆ†ç±»
            const categoryOrder = ['gameplay', 'world', 'player', 'mob', 'chat', 'other'];
            categoryOrder.forEach(category => {
                if (categorizedRules[category]) {
                    const categoryName = {
                        'gameplay': 'ğŸ® æ¸¸æˆç©æ³•',
                        'world': 'ğŸŒ ä¸–ç•Œè®¾ç½®',
                        'player': 'ğŸ‘¤ ç©å®¶ç›¸å…³',
                        'mob': 'ğŸ¾ ç”Ÿç‰©ç›¸å…³',
                        'chat': 'ğŸ’¬ èŠå¤©ç›¸å…³',
                        'other': 'ğŸ“¦ å…¶ä»–è§„åˆ™'
                    }[category];
                    
                    html += `<div class="gamerule-category">
                        <h3>${categoryName}</h3>
                        ${categorizedRules[category].map(rule => createRuleHTML(rule)).join('')}
                    </div>`;
                }
            });

            container.innerHTML = html;
        }

        function createRuleHTML(rule) {
            const description = ruleDescriptions[rule.key] || 'æš‚æ— æè¿°';
            const valueType = detectValueType(rule.value);
            const category = ruleCategories[rule.key] || 'other';
            
            return `
                <div class="gamerule-item" data-type="${valueType}" data-category="${category}" data-name="${rule.key.toLowerCase()}">
                    <div class="gamerule-info">
                        <div class="gamerule-name">
                            ${rule.key}
                            <span class="gamerule-type ${valueType}">${getTypeName(valueType)}</span>
                        </div>
                        <div class="gamerule-description">${description}</div>
                    </div>
                    <div class="gamerule-controls">
                        ${createRuleControl(rule, valueType)}
                    </div>
                </div>
            `;
        }

        function createRuleControl(rule, valueType) {
            const ruleId = `rule_${rule.key.replace(/[^a-zA-Z0-9]/g, '_')}`;
            
            // ç»Ÿä¸€å¤„ç†å¸ƒå°”å€¼ï¼Œæ— è®ºåŸå§‹ç±»å‹æ˜¯ä»€ä¹ˆ
            const isBooleanValue = valueType === 'boolean';
            const boolValue = isBooleanValue ? 
                (typeof rule.value === 'boolean' ? rule.value : rule.value === 'true') : 
                false;
            
            if (isBooleanValue) {
                return `
                    <span class="gamerule-value ${boolValue}">${boolValue ? 'å¼€å¯' : 'å…³é—­'}</span>
                    <button class="gamerule-btn toggle ${boolValue ? '' : 'off'}" 
                            onclick="toggleRule('${rule.key}', ${!boolValue})">
                        ${boolValue ? 'å¼€' : 'å…³'}
                    </button>
                `;
            }
            
            switch (valueType) {
                case 'number':
                    return `
                        <input type="number" class="number-input" id="${ruleId}" value="${rule.value}" 
                               onchange="updateRuleValue('${rule.key}', this.value)">
                        <button class="gamerule-btn apply" onclick="applyRule('${rule.key}')">âœ… åº”ç”¨</button>
                        <button class="gamerule-btn reset" onclick="resetRule('${rule.key}')">ğŸ”„ é‡ç½®</button>
                    `;
                
                case 'string':
                    return `
                        <input type="text" class="text-input" id="${ruleId}" value="${rule.value}" 
                               onchange="updateRuleValue('${rule.key}', this.value)">
                        <button class="gamerule-btn apply" onclick="applyRule('${rule.key}')">âœ… åº”ç”¨</button>
                        <button class="gamerule-btn reset" onclick="resetRule('${rule.key}')">ğŸ”„ é‡ç½®</button>
                    `;
                
                default:
                    return `
                        <span class="gamerule-value">${rule.value}</span>
                    `;
            }
        }

        function detectValueType(value) {
            // é¦–å…ˆæ£€æŸ¥æ˜¯å¦æ˜¯å¸ƒå°”å€¼ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²å½¢å¼çš„å¸ƒå°”å€¼ï¼‰
            if (typeof value === 'boolean') return 'boolean';
            if (value === 'true' || value === 'false') return 'boolean';
            
            // ç„¶åæ£€æŸ¥æ˜¯å¦æ˜¯æ•°å­—
            if (typeof value === 'number') return 'number';
            if (!isNaN(value) && value.toString().trim() !== '') return 'number';
            
            // é»˜è®¤ä¸ºå­—ç¬¦ä¸²
            return 'string';
        }

        function getTypeName(type) {
            return {
                'boolean': 'å¸ƒå°”',
                'number': 'æ•°å­—',
                'string': 'æ–‡æœ¬'
            }[type];
        }

        // è§„åˆ™æ“ä½œå‡½æ•°
        function toggleRule(ruleKey, newValue) {
            addLog(`ğŸ”„ åˆ‡æ¢è§„åˆ™ ${ruleKey}: ${newValue ? 'å¼€å¯' : 'å…³é—­'}`, 'info');
            
            // æœåŠ¡å™¨éœ€è¦å­—ç¬¦ä¸²å½¢å¼çš„å¸ƒå°”å€¼
            const stringValue = newValue ? "true" : "false";
            
            // ç›´æ¥å‘é€è¯·æ±‚æ›´æ–°è§„åˆ™
            sendRequest('gamerules/update', [{ key: ruleKey, value: stringValue }])
                .then(() => {
                    addLog(`âœ… æ¸¸æˆè§„åˆ™å·²æ›´æ–°: ${ruleKey} = ${stringValue}`, 'success');
                    // ç«‹å³æ›´æ–°ç•Œé¢æ˜¾ç¤º
                    updateRuleDisplay(ruleKey, newValue);
                })
                .catch((error) => {
                    addLog(`âŒ æ›´æ–°æ¸¸æˆè§„åˆ™å¤±è´¥: ${ruleKey} - ${error.message}`, 'error');
                    // æ¢å¤åŸå€¼
                    getGameRules();
                });
        }

        function updateRuleDisplay(ruleKey, newValue) {
            const ruleItem = document.querySelector(`[data-name="${ruleKey.toLowerCase()}"]`);
            if (ruleItem) {
                const valueElement = ruleItem.querySelector('.gamerule-value');
                const toggleButton = ruleItem.querySelector('.gamerule-btn.toggle');
                
                if (valueElement) {
                    valueElement.textContent = newValue ? 'å¼€å¯' : 'å…³é—­';
                    valueElement.className = `gamerule-value ${newValue}`;
                }
                
                if (toggleButton) {
                    toggleButton.textContent = newValue ? 'å¼€' : 'å…³';
                    toggleButton.className = `gamerule-btn toggle ${newValue ? '' : 'off'}`;
                    // æ›´æ–°ç‚¹å‡»äº‹ä»¶ï¼Œä½¿ç”¨æ–°çš„å€¼
                    toggleButton.setAttribute('onclick', `toggleRule('${ruleKey}', ${!newValue})`);
                }
            }
        }

        function updateRuleValue(ruleKey, newValue) {
            addLog(`ğŸ“ æ›´æ–°è§„åˆ™ ${ruleKey}: ${newValue}`, 'info');
        }

        function applyRule(ruleKey) {
            const ruleId = `rule_${ruleKey.replace(/[^a-zA-Z0-9]/g, '_')}`;
            const inputElement = document.getElementById(ruleId);
            let newValue;

            if (inputElement.type === 'checkbox') {
                newValue = inputElement.checked;
            } else {
                newValue = inputElement.value;
                // å°è¯•è½¬æ¢ä¸ºæ•°å­—
                if (!isNaN(newValue) && newValue.trim() !== '') {
                    newValue = Number(newValue);
                }
            }

            // å¯¹äºå¸ƒå°”ç±»å‹çš„è§„åˆ™ï¼Œéœ€è¦è½¬æ¢ä¸ºå­—ç¬¦ä¸²
            const ruleItem = document.querySelector(`[data-name="${ruleKey.toLowerCase()}"]`);
            if (ruleItem && ruleItem.getAttribute('data-type') === 'boolean') {
                newValue = newValue ? "true" : "false";
            } else if (ruleItem && ruleItem.getAttribute('data-type') === 'number') {
                // å¯¹äºæ•°å­—ç±»å‹çš„è§„åˆ™ï¼Œç¡®ä¿ä¼ é€’å­—ç¬¦ä¸²è€Œä¸æ˜¯æ•°å­—
                newValue = newValue.toString();
            }

            sendRequest('gamerules/update', [{ key: ruleKey, value: newValue }])
                .then(() => {
                    addLog(`âœ… æ¸¸æˆè§„åˆ™å·²æ›´æ–°: ${ruleKey} = ${newValue}`, 'success');
                    // é‡æ–°åŠ è½½ä»¥ç¡®è®¤æ›´æ–°
                    setTimeout(() => getGameRules(), 500);
                })
                .catch((error) => {
                    addLog(`âŒ æ›´æ–°æ¸¸æˆè§„åˆ™å¤±è´¥: ${ruleKey} - ${error.message}`, 'error');
                    // æ¢å¤åŸå€¼
                    getGameRules();
                });
        }

        function resetRule(ruleKey) {
            const defaultValue = defaultValues[ruleKey];
            if (defaultValue !== undefined) {
                sendRequest('gamerules/update', [{ key: ruleKey, value: defaultValue }])
                    .then(() => {
                        addLog(`âœ… è§„åˆ™å·²é‡ç½®: ${ruleKey} = ${defaultValue}`, 'success');
                        setTimeout(() => getGameRules(), 500);
                    })
                    .catch((error) => {
                        addLog(`âŒ é‡ç½®è§„åˆ™å¤±è´¥: ${ruleKey} - ${error.message}`, 'error');
                    });
            } else {
                addLog(`âš ï¸ æœªçŸ¥è§„åˆ™çš„é»˜è®¤å€¼: ${ruleKey}`, 'warning');
            }
        }

        function resetAllRules() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ¸¸æˆè§„åˆ™ä¸ºé»˜è®¤å€¼å—ï¼Ÿ')) {
                addLog('ğŸ”„ æ­£åœ¨é‡ç½®æ‰€æœ‰æ¸¸æˆè§„åˆ™...', 'info');
                
                // è·å–å½“å‰è§„åˆ™ç„¶åé‡ç½®
                sendRequest('gamerules', [])
                    .then(rules => {
                        let resetPromises = [];
                        rules.forEach(rule => {
                            const defaultValue = defaultValues[rule.key];
                            if (defaultValue !== undefined && rule.value !== defaultValue) {
                                resetPromises.push(
                                    sendRequest('gamerules/update', [{ key: rule.key, value: defaultValue }])
                                );
                            }
                        });
                        
                        return Promise.allSettled(resetPromises);
                    })
                    .then(results => {
                        const successful = results.filter(r => r.status === 'fulfilled').length;
                        const failed = results.filter(r => r.status === 'rejected').length;
                        
                        addLog(`âœ… é‡ç½®å®Œæˆ: ${successful} æ¡è§„åˆ™æˆåŠŸ, ${failed} æ¡è§„åˆ™å¤±è´¥`, 'success');
                        getGameRules();
                    })
                    .catch(error => {
                        addLog(`âŒ é‡ç½®è¿‡ç¨‹å‡ºé”™: ${error.message}`, 'error');
                    });
            }
        }

        // ç­›é€‰åŠŸèƒ½
        function filterRules() {
            const searchTerm = document.getElementById('ruleSearch').value.toLowerCase();
            const categoryFilter = document.getElementById('ruleCategoryFilter').value;
            
            const rules = document.querySelectorAll('.gamerule-item');
            
            rules.forEach(rule => {
                const ruleName = rule.getAttribute('data-name');
                const ruleCategory = rule.getAttribute('data-category');
                
                const matchesSearch = ruleName.includes(searchTerm);
                const matchesCategory = categoryFilter === 'all' || ruleCategory === categoryFilter;
                
                if (matchesSearch && matchesCategory) {
                    rule.style.display = 'flex';
                } else {
                    rule.style.display = 'none';
                }
            });
        }

        // æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        async function checkServerStatus() {
            try {
                const response = await fetch('/api/server/status', {
                    headers: {
                        'X-Session-ID': sessionId
                    }
                });
                
                const result = await response.json();
                serverRunning = result.running;
                
                const indicator = document.getElementById('serverStatusIndicator');
                const statusText = document.getElementById('serverStatusText');
                const startBtn = document.getElementById('startServerBtn');
                const normalStopBtn = document.getElementById('normalStopBtn');
                const forceStopBtn = document.getElementById('forceStopBtn');
                
                if (serverRunning) {
                    indicator.className = 'server-indicator on';
                    statusText.textContent = 'æœåŠ¡å™¨çŠ¶æ€: è¿è¡Œä¸­';
                    startBtn.disabled = true;
                    normalStopBtn.disabled = false;
                    forceStopBtn.disabled = false;
                    startBtn.innerHTML = 'ğŸš€ è¿è¡Œä¸­';
                    normalStopBtn.innerHTML = 'ğŸ›‘ åœæ­¢æœåŠ¡å™¨';
                    forceStopBtn.innerHTML = 'â›” å¼ºåˆ¶åœæ­¢';
                } else {
                    indicator.className = 'server-indicator off';
                    statusText.textContent = 'æœåŠ¡å™¨çŠ¶æ€: å·²åœæ­¢';
                    startBtn.disabled = false;
                    normalStopBtn.disabled = true;
                    forceStopBtn.disabled = true;
                    startBtn.innerHTML = 'ğŸš€ å¯åŠ¨æœåŠ¡å™¨';
                    normalStopBtn.innerHTML = 'ğŸ›‘ å·²åœæ­¢';
                    forceStopBtn.innerHTML = 'â›” å¼ºåˆ¶åœæ­¢';
                    
                    // æœåŠ¡å™¨åœæ­¢æ—¶æ›´æ–° RCON çŠ¶æ€
                    rconEnabled = false;
                    updateRconStatusDisplay();
                }
            } catch (error) {
                console.error('æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€å¤±è´¥:', error);
                // å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œå‡è®¾æœåŠ¡å™¨å·²åœæ­¢
                serverRunning = false;
                updateServerStatusDisplay(false);
            }
        }

        // æ›´æ–°æœåŠ¡å™¨çŠ¶æ€æ˜¾ç¤º
        function updateServerStatusDisplay(isRunning) {
            const indicator = document.getElementById('serverStatusIndicator');
            const statusText = document.getElementById('serverStatusText');
            const startBtn = document.getElementById('startServerBtn');
            const normalStopBtn = document.getElementById('normalStopBtn');
            const forceStopBtn = document.getElementById('forceStopBtn');
            
            if (isRunning) {
                indicator.className = 'server-indicator on';
                statusText.textContent = 'æœåŠ¡å™¨çŠ¶æ€: è¿è¡Œä¸­';
                startBtn.disabled = true;
                normalStopBtn.disabled = false;
                forceStopBtn.disabled = false;
                startBtn.innerHTML = 'ğŸš€ è¿è¡Œä¸­';
                normalStopBtn.innerHTML = 'ğŸ›‘ åœæ­¢æœåŠ¡å™¨';
                forceStopBtn.innerHTML = 'â›” å¼ºåˆ¶åœæ­¢';
            } else {
                indicator.className = 'server-indicator off';
                statusText.textContent = 'æœåŠ¡å™¨çŠ¶æ€: å·²åœæ­¢';
                startBtn.disabled = false;
                normalStopBtn.disabled = true;
                forceStopBtn.disabled = true;
                startBtn.innerHTML = 'ğŸš€ å¯åŠ¨æœåŠ¡å™¨';
                normalStopBtn.innerHTML = 'ğŸ›‘ å·²åœæ­¢';
                forceStopBtn.innerHTML = 'â›” å¼ºåˆ¶åœæ­¢';
            }
        }

        // å¯åŠ¨æœåŠ¡å™¨
        async function startServer() {
            if (!confirm('ç¡®å®šè¦å¯åŠ¨ Minecraft æœåŠ¡å™¨å—ï¼Ÿ')) return;
            
            addLog('ğŸ”„ æ­£åœ¨å¯åŠ¨æœåŠ¡å™¨...', 'info');
            
            try {
                const response = await fetch('/api/server/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog(`âœ… ${result.message}`, 'success');
                    // å¯åŠ¨åå»¶è¿Ÿæ£€æŸ¥çŠ¶æ€
                    setTimeout(() => {
                        checkServerStatus();
                    }, 5000);
                } else {
                    addLog(`âŒ ${result.message}`, 'error');
                }
            } catch (error) {
                addLog(`âŒ å¯åŠ¨æœåŠ¡å™¨å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // å¼ºåˆ¶åœæ­¢æœåŠ¡å™¨
        async function forceStopServer() {
            if (!confirm('ç¡®å®šè¦å¼ºåˆ¶åœæ­¢æœåŠ¡å™¨å—ï¼Ÿè¿™å¯èƒ½ä¼šé€ æˆæ•°æ®ä¸¢å¤±ï¼')) return;
            
            addLog('ğŸ›‘ æ­£åœ¨å¼ºåˆ¶åœæ­¢æœåŠ¡å™¨...', 'warning');
            
            try {
                const response = await fetch('/api/server/stop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog(`âœ… ${result.message}`, 'success');
                    // å¼ºåˆ¶åœæ­¢åç«‹å³æ›´æ–°çŠ¶æ€
                    setTimeout(() => {
                        checkServerStatus();
                        checkRconStatus();
                        // æ–­å¼€ WebSocket è¿æ¥
                        if (ws) {
                            disconnect();
                        }
                    }, 2000);
                } else {
                    addLog(`âŒ ${result.message}`, 'error');
                }
            } catch (error) {
                addLog(`âŒ åœæ­¢æœåŠ¡å™¨å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„ä¼šè¯
            const savedSession = localStorage.getItem('mc_session');
            if (savedSession) {
                sessionId = savedSession;
                // éªŒè¯ä¼šè¯æœ‰æ•ˆæ€§
                checkSessionValidity();
            }
            
            // ç»‘å®šå›è½¦é”®åˆ°ç™»å½•
            document.getElementById('loginPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            // è®¾ç½®é»˜è®¤å€¼
            document.getElementById('wsHost').value = '';
            document.getElementById('wsPort').value = '';
            
            // æ˜¾ç¤ºç™»å½•ç•Œé¢
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('mainInterface').style.display = 'none';
        });

        // æ£€æŸ¥ä¼šè¯æœ‰æ•ˆæ€§
        async function checkSessionValidity() {
            try {
                const response = await fetch('/api/check', {
                    headers: {
                        'X-Session-ID': sessionId
                    }
                });
                
                const result = await response.json();
                if (result.success) {
                    // ä¼šè¯æœ‰æ•ˆï¼Œç›´æ¥æ˜¾ç¤ºç®¡ç†ç•Œé¢
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('mainInterface').style.display = 'block';
                    startStatusPolling();
                    setTimeout(() => connect(), 500);
                } else {
                    // ä¼šè¯æ— æ•ˆï¼Œæ¸…é™¤å­˜å‚¨
                    localStorage.removeItem('mc_session');
                    sessionId = null;
                }
            } catch (error) {
                console.error('ä¼šè¯æ£€æŸ¥å¤±è´¥:', error);
                localStorage.removeItem('mc_session');
                sessionId = null;
            }
        }
    </script>
</body>
</html>