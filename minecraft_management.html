<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src 'self' ws: wss:; img-src 'self' data:;">
    <title>SimpleMC--ÊàëÁöÑ‰∏ñÁïåÊúçÂä°Âô®ÁÆ°ÁêÜÈù¢Êùø</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #3498db;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #95a5a6;
        }

        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* ÁôªÂΩïÁïåÈù¢Ê†∑Âºè */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-card h1 {
            color: var(--dark);
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .login-error {
            color: var(--danger);
            margin-top: 10px;
            display: none;
        }

        /* ‰∏ªÁïåÈù¢Ê†∑Âºè - ÈöêËóèÁõ¥Âà∞ÁôªÂΩï */
        .main-interface {
            display: none;
        }

        /* Â§¥ÈÉ®Ê†∑Âºè */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header h1 {
            color: var(--dark);
            font-size: 2.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header h1::before {
            content: "üéÆ";
            font-size: 2.2rem;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status {
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status::before {
            content: "";
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        .status.disconnected {
            background: #ffebee;
            color: #c62828;
        }
        .status.disconnected::before { background: #c62828; }

        .status.connected {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .status.connected::before { background: #2e7d32; }

        .status.connecting {
            background: #fff3e0;
            color: #ef6c00;
        }
        .status.connecting::before { background: #ef6c00; }

        .connection-panel {
            display: grid;
            grid-template-columns: 1fr 1fr auto auto;
            gap: 20px;
            align-items: end;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            color: var(--dark);
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .input-group input {
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(39, 174, 96, 0.3);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-small {
            padding: 10px 18px;
            font-size: 12px;
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫Âüü */
        .main-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary);
        }

        .card h2 {
            color: var(--dark);
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-actions {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }

        /* ÁÆ°ÁêÜÂç°ÁâáÂÆπÂô®Ê†∑Âºè - ÈôêÂà∂È´òÂ∫¶Âπ∂Ê∑ªÂä†ÊªöÂä®Êù° */
        .management-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            background: #f8f9fa;
        }

        .management-container::-webkit-scrollbar {
            width: 8px;
        }

        .management-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .management-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .management-container::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* ÊêúÁ¥¢Ê†èÊ†∑Âºè */
        .search-container {
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* ÊéßÂà∂Âè∞Êó•Âøó */
        .log-container {
            background: #1e1e1e;
            border-radius: 12px;
            padding: 20px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }

        .log-entry {
            margin-bottom: 10px;
            padding: 5px 0;
            border-bottom: 1px solid #2a2a2a;
        }

        .log-entry.info { color: #4fc3f7; }
        .log-entry.success { color: #66bb6a; }
        .log-entry.error { color: #ef5350; }
        .log-entry.warning { color: #ffb74d; }

        .command-input {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .command-input input {
            flex: 1;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            background: white;
        }

        /* Á¥ßÂáëÁöÑÁé©ÂÆ∂È°πÊ†∑Âºè */
        .compact-player-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border-left: 3px solid var(--primary);
            font-size: 0.9rem;
        }

        .compact-player-item:hover {
            transform: translateX(3px);
            background: #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .compact-player-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .compact-player-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 2px;
        }

        .compact-player-uuid {
            color: var(--gray);
            font-size: 0.7rem;
            font-family: 'Consolas', monospace;
        }

        .compact-player-actions {
            display: flex;
            gap: 6px;
        }

        /* Ê∏∏ÊàèËßÑÂàôÂºÄÂÖ≥Ê†∑Âºè */
        .gamerule-item {
            background: #f8f9fa;
            padding: 18px;
            margin-bottom: 12px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary);
        }

        .gamerule-item:hover {
            transform: translateX(3px);
            background: #e9ecef;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .gamerule-info {
            flex: 1;
        }

        .gamerule-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 4px;
            font-size: 1rem;
        }

        .gamerule-description {
            color: var(--gray);
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .gamerule-type {
            display: inline-block;
            padding: 2px 8px;
            background: var(--info);
            color: white;
            border-radius: 10px;
            font-size: 0.75rem;
            margin-left: 8px;
        }

        .gamerule-type.boolean { background: var(--success); }
        .gamerule-type.number { background: var(--info); }
        .gamerule-type.string { background: var(--warning); }

        .gamerule-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        /* ÂºÄÂÖ≥ÊåâÈíÆÊ†∑Âºè */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--success);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        input:disabled + .slider {
            background-color: #e0e0e0;
            cursor: not-allowed;
        }

        input:disabled + .slider:before {
            background-color: #f5f5f5;
        }

        /* Êï∞Â≠óËæìÂÖ•Ê†∑Âºè */
        .number-input {
            width: 120px;
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
        }

        .number-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* ÊñáÊú¨ËæìÂÖ•Ê†∑Âºè */
        .text-input {
            width: 200px;
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* ËßÑÂàôÂÄºÊòæÁ§∫ */
        .gamerule-value {
            font-family: 'Consolas', monospace;
            background: var(--light);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.9rem;
            min-width: 80px;
            text-align: center;
        }

        .gamerule-value.true { background: #e8f5e9; color: var(--success); }
        .gamerule-value.false { background: #ffebee; color: var(--danger); }
        .gamerule-value.number { background: #e3f2fd; color: var(--info); }
        .gamerule-value.string { background: #fff3e0; color: var(--warning); }

        /* Êìç‰ΩúÊåâÈíÆ */
        .gamerule-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .gamerule-btn.apply {
            background: var(--success);
            color: white;
        }

        .gamerule-btn.apply:hover:not(:disabled) {
            background: #229954;
            transform: translateY(-1px);
        }

        .gamerule-btn.reset {
            background: var(--gray);
            color: white;
        }

        .gamerule-btn.reset:hover:not(:disabled) {
            background: #7f8c8d;
            transform: translateY(-1px);
        }

        .gamerule-btn.toggle {
            background: var(--success);
            color: white;
            min-width: 60px;
        }

        .gamerule-btn.toggle.off {
            background: var(--danger);
        }

        .gamerule-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* ËßÑÂàôÂàÜÁªÑ */
        .gamerule-category {
            margin-bottom: 25px;
        }

        .gamerule-category h3 {
            color: var(--dark);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
            font-size: 1.2rem;
        }

        /* ÊêúÁ¥¢ÂíåÁ≠õÈÄâ */
        .gamerule-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-input {
            flex: 1;
            min-width: 250px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
        }

        .filter-select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
            min-width: 150px;
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* ÂÖ®ÂÆΩÂç°Áâá */
        .full-width {
            grid-column: 1 / -1;
        }

        /* ‰∫ã‰ª∂ÂÆπÂô® */
        .events-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .event-item {
            background: white;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 10px;
            border-left: 4px solid var(--info);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .event-time {
            color: var(--gray);
            font-size: 11px;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .event-type {
            font-weight: 600;
            color: var(--info);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .event-data {
            color: var(--dark);
            font-size: 12px;
            font-family: 'Consolas', monospace;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
            overflow-x: auto;
        }

        /* Ë°®ÂçïÁªÑ */
        .form-group {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .form-group input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
        }

        /* Ê†áÁ≠æÈ°µÊ†∑Âºè */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray);
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ÁôΩÂêçÂçïÁä∂ÊÄÅÊåáÁ§∫Âô® */
        .whitelist-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-indicator.on {
            background: var(--success);
        }

        .status-indicator.off {
            background: var(--danger);
        }

        /* RCON Áä∂ÊÄÅÊåáÁ§∫Âô® */
        .rcon-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .rcon-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .rcon-indicator.on {
            background: var(--success);
        }

        .rcon-indicator.off {
            background: var(--danger);
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header-top {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .connection-panel {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .connection-status {
                justify-content: flex-start;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .card {
                padding: 20px;
            }
            
            .form-group {
                flex-direction: column;
            }
            
            .form-group input {
                min-width: 100%;
            }

            .gamerule-filters {
                flex-direction: column;
            }

            .gamerule-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .gamerule-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
        }

        /* ÊªöÂä®Êù°Ê†∑Âºè */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Á©∫Áä∂ÊÄÅ */
        .empty-state {
            text-align: center;
            color: var(--gray);
            padding: 40px 20px;
            font-style: italic;
        }

        /* Âä†ËΩΩÂä®Áîª */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ÊúçÂä°Âô®Áä∂ÊÄÅÊåáÁ§∫Âô® */
        .server-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .server-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .server-indicator.on {
            background: var(--success);
            animation: pulse 2s infinite;
        }

        .server-indicator.off {
            background: var(--danger);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- ÁôªÂΩïÁïåÈù¢ -->
    <div class="login-container" id="loginContainer">
        <div class="login-card">
            <h1>üîê ÁÆ°ÁêÜÂëòÁôªÂΩï</h1>
            <input type="text" class="login-input" id="loginUsername" placeholder="Áî®Êà∑Âêç">
            <input type="password" class="login-input" id="loginPassword" placeholder="ÂØÜÁ†Å">
            <button class="login-btn" onclick="login()">ÁôªÂΩï</button>
            <div class="login-error" id="loginError">Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ</div>
        </div>
    </div>

    <!-- ‰∏ªÁïåÈù¢ -->
    <div class="main-interface" id="mainInterface">
        <div class="container">
            <div class="header">
                <div class="header-top">
                    <h1>SimpleMC ÊàëÁöÑ‰∏ñÁïåÊúçÂä°Âô®ÁÆ°ÁêÜÈù¢Êùø</h1>
                    <div class="connection-status">
                        <span class="status disconnected" id="statusIndicator">
                            <span class="status-text">Êú™ËøûÊé•</span>
                        </span>
                        <button class="btn btn-warning btn-small" onclick="logout()">üö™ ÈÄÄÂá∫ÁôªÂΩï</button>
                    </div>
                </div>
                
                <div class="connection-panel">
                    <div class="input-group">
                        <label>üñ•Ô∏è ‰ª£ÁêÜÊúçÂä°Âô®Âú∞ÂùÄ</label>
                        <input type="text" id="wsHost" value="" placeholder="‰æãÂ¶Ç: localhost Êàñ 127.0.0.1">
                    </div>
                    <div class="input-group">
                        <label>üîå ‰ª£ÁêÜÊúçÂä°Âô®Á´ØÂè£</label>
                        <input type="number" id="wsPort" value="" placeholder="ÈªòËÆ§: 8765">
                    </div>
                    <button class="btn btn-primary" onclick="connect()" id="connectBtn">
                        <span>üîó ËøûÊé•ÊúçÂä°Âô®</span>
                    </button>
                    <button class="btn btn-danger" onclick="disconnect()" id="disconnectBtn" disabled>
                        <span>‚ùå Êñ≠ÂºÄËøûÊé•</span>
                    </button>
                </div>
            </div>

            <div class="main-content">
                <!-- ÊéßÂà∂Âè∞Êó•Âøó -->
                <div class="card full-width">
                    <div class="card-header">
                        <h2>üìù ÊúçÂä°Âô®ÊéßÂà∂Âè∞</h2>
                        <div class="rcon-status">
                            <span class="rcon-indicator off" id="rconStatusIndicator"></span>
                            <span id="rconStatusText">RCON Áä∂ÊÄÅ: Ê£ÄÊµã‰∏≠...</span>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-info btn-small" onclick="clearLogs()">üóëÔ∏è Ê∏ÖÁ©∫Êó•Âøó</button>
                        </div>
                    </div>

                    <div class="server-status">
                        <span class="server-indicator off" id="serverStatusIndicator"></span>
                        <span id="serverStatusText">ÊúçÂä°Âô®Áä∂ÊÄÅ: Ê£ÄÊµã‰∏≠...</span>
                        <div style="margin-left: auto; display: flex; gap: 10px;">
                            <button class="btn btn-primary btn-small" onclick="startServer()" id="startServerBtn">üöÄ ÂêØÂä®ÊúçÂä°Âô®</button>
                            <button class="btn btn-success btn-small" onclick="saveAll()">üíæ ‰øùÂ≠ò‰∏ñÁïå</button>
                            <button class="btn btn-danger btn-small" onclick="stopServer()" id="normalStopBtn">üõë ÂÅúÊ≠¢ÊúçÂä°Âô®</button>
                            <button class="btn btn-danger btn-small" onclick="forceStopServer()" id="forceStopBtn">üõë Âº∫Âà∂ÂÅúÊ≠¢</button>
                        </div>
                    </div>
                    <div class="log-container" id="logContainer"></div>
                    <div class="command-input">
                        <input type="text" id="commandInput" placeholder="ËæìÂÖ• Minecraft ÊúçÂä°Âô®ÂëΩ‰ª§ (Â¶Ç: time set day, give player diamond...)..." onkeypress="handleCommandKeypress(event)">
                        <button class="btn btn-success" onclick="executeRconCommand()">üöÄ ÊâßË°åÂëΩ‰ª§</button>
                    </div>
                </div>

                <!-- ‰∏§ÂàóÂ∏ÉÂ±Ä -->
                <div class="card">
                    <div class="card-header">
                        <h2>üë• Âú®Á∫øÁé©ÂÆ∂</h2>
                        <div class="card-actions">
                            <button class="btn btn-primary btn-small" onclick="getPlayers()">üîÑ Âà∑Êñ∞ÂàóË°®</button>
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" class="search-input" id="playersSearch" placeholder="üîç ÊêúÁ¥¢Áé©ÂÆ∂..." oninput="filterPlayers()">
                    </div>
                    <div class="management-container">
                        <ul class="players-list" id="playersList">
                            <li class="empty-state">ÁÇπÂáªÂà∑Êñ∞ÊåâÈíÆËé∑ÂèñÂú®Á∫øÁé©ÂÆ∂ÂàóË°®</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>‚ö° ÊúçÂä°Âô®‰∫ã‰ª∂</h2>
                        <div class="card-actions">
                            <button class="btn btn-info btn-small" onclick="clearEvents()">üóëÔ∏è Ê∏ÖÁ©∫‰∫ã‰ª∂</button>
                        </div>
                    </div>
                    <div class="management-container">
                        <div id="eventsContainer">
                            <div class="empty-state">ÊúçÂä°Âô®‰∫ã‰ª∂Â∞ÜÂú®ËøôÈáåÊòæÁ§∫</div>
                        </div>
                    </div>
                </div>

                <!-- ÁÆ°ÁêÜÂäüËÉΩÊ†áÁ≠æÈ°µ -->
                <div class="card full-width">
                    <div class="card-header">
                        <h2>üõ°Ô∏è ÊúçÂä°Âô®ÁÆ°ÁêÜ</h2>
                    </div>
                    
                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('whitelist')">‚úÖ ÁôΩÂêçÂçï</button>
                        <button class="tab" onclick="switchTab('bans')">üö´ Â∞ÅÁ¶ÅÁÆ°ÁêÜ</button>
                        <button class="tab" onclick="switchTab('admins')">üëë ÁÆ°ÁêÜÂëò</button>
                        <button class="tab" onclick="switchTab('gamerules')">‚öôÔ∏è Ê∏∏ÊàèËßÑÂàô</button>
                    </div>

                    <!-- ÁôΩÂêçÂçïÁÆ°ÁêÜ -->
                    <div class="tab-content active" id="whitelist-tab">
                        <div class="whitelist-status">
                            <span class="status-indicator off" id="whitelistStatusIndicator"></span>
                            <span id="whitelistStatusText">Ê≠£Âú®Ëé∑ÂèñÁôΩÂêçÂçïÁä∂ÊÄÅ...</span>
                            <div style="margin-left: auto; display: flex; gap: 10px;">
                                <button class="btn btn-success btn-small" onclick="toggleWhitelist(true)" id="enableWhitelistBtn">‚úÖ ÂêØÁî®ÁôΩÂêçÂçï</button>
                                <button class="btn btn-danger btn-small" onclick="toggleWhitelist(false)" id="disableWhitelistBtn">‚ùå ÂÖ≥Èó≠ÁôΩÂêçÂçï</button>
                            </div>
                        </div>
                        <div class="search-container">
                            <input type="text" class="search-input" id="whitelistSearch" placeholder="üîç ÊêúÁ¥¢Áé©ÂÆ∂ÂêçÁß∞..." oninput="filterWhitelist()">
                        </div>
                        <div class="form-group">
                            <input type="text" id="addWhitelistPlayer" placeholder="ËæìÂÖ•Áé©ÂÆ∂ÂêçÁß∞">
                            <button class="btn btn-success" onclick="addToWhitelist()">‚ûï Ê∑ªÂä†Áé©ÂÆ∂</button>
                            <button class="btn btn-primary" onclick="getWhitelist()">üîÑ Âà∑Êñ∞ÂàóË°®</button>
                        </div>
                        <div class="management-container">
                            <div id="whitelistContainer">
                                <div class="empty-state">ÁôΩÂêçÂçïÂàóË°®Â∞ÜÂú®ËøôÈáåÊòæÁ§∫</div>
                            </div>
                        </div>
                    </div>

                    <!-- Â∞ÅÁ¶ÅÁÆ°ÁêÜ -->
                    <div class="tab-content" id="bans-tab">
                        <div class="search-container">
                            <input type="text" class="search-input" id="bansSearch" placeholder="üîç ÊêúÁ¥¢Áé©ÂÆ∂ÂêçÁß∞ÊàñIP..." oninput="filterBans()">
                        </div>
                        <div class="form-group">
                            <input type="text" id="banPlayerName" placeholder="Áé©ÂÆ∂ÂêçÁß∞">
                            <input type="text" id="banReason" placeholder="Â∞ÅÁ¶ÅÂéüÂõ†">
                            <button class="btn btn-danger" onclick="banPlayer()">üö´ Â∞ÅÁ¶ÅÁé©ÂÆ∂</button>
                            <button class="btn btn-warning" onclick="getBans()">üîÑ Âà∑Êñ∞Áé©ÂÆ∂Â∞ÅÁ¶Å</button>
                        </div>
                        <div class="form-group">
                            <input type="text" id="banIP" placeholder="IPÂú∞ÂùÄ">
                            <input type="text" id="banIPReason" placeholder="Â∞ÅÁ¶ÅÂéüÂõ†">
                            <button class="btn btn-danger" onclick="banIP()">üåê Â∞ÅÁ¶Å IP</button>
                            <button class="btn btn-warning" onclick="getIPBans()">üîÑ Âà∑Êñ∞ IP Â∞ÅÁ¶Å</button>
                        </div>
                        <div class="management-container">
                            <div id="bansContainer">
                                <div class="empty-state">Â∞ÅÁ¶ÅÂàóË°®Â∞ÜÂú®ËøôÈáåÊòæÁ§∫</div>
                            </div>
                        </div>
                    </div>

                    <!-- ÁÆ°ÁêÜÂëòÁÆ°ÁêÜ -->
                    <div class="tab-content" id="admins-tab">
                        <div class="search-container">
                            <input type="text" class="search-input" id="adminsSearch" placeholder="üîç ÊêúÁ¥¢ÁÆ°ÁêÜÂëò..." oninput="filterAdmins()">
                        </div>
                        <div class="form-group">
                            <input type="text" id="addAdminPlayer" placeholder="Áé©ÂÆ∂ÂêçÁß∞">
                            <input type="number" id="adminLevel" placeholder="ÊùÉÈôêÁ≠âÁ∫ß (0-4)" min="0" max="4" value="4">
                            <button class="btn btn-success" onclick="addAdmin()">‚ûï Ê∑ªÂä†ÁÆ°ÁêÜÂëò</button>
                            <button class="btn btn-primary" onclick="getAdmins()">üîÑ Âà∑Êñ∞ÂàóË°®</button>
                        </div>
                        <div class="management-container">
                            <div id="adminsContainer">
                                <div class="empty-state">ÁÆ°ÁêÜÂëòÂàóË°®Â∞ÜÂú®ËøôÈáåÊòæÁ§∫</div>
                            </div>
                        </div>
                    </div>

                    <!-- Ê∏∏ÊàèËßÑÂàôÁÆ°ÁêÜ -->
                    <div class="tab-content" id="gamerules-tab">
                        <div class="gamerule-filters">
                            <input type="text" class="filter-input" id="ruleSearch" placeholder="üîç ÊêúÁ¥¢Ê∏∏ÊàèËßÑÂàô..." onkeyup="filterRules()">
                            <select class="filter-select" id="ruleCategoryFilter" onchange="filterRules()">
                                <option value="all">ÊâÄÊúâÂàÜÁ±ª</option>
                                <option value="gameplay">Ê∏∏ÊàèÁé©Ê≥ï</option>
                                <option value="world">‰∏ñÁïåËÆæÁΩÆ</option>
                                <option value="player">Áé©ÂÆ∂Áõ∏ÂÖ≥</option>
                                <option value="mob">ÁîüÁâ©Áõ∏ÂÖ≥</option>
                                <option value="chat">ËÅäÂ§©Áõ∏ÂÖ≥</option>
                            </select>
                        </div>
                        <div class="management-container">
                            <div id="gameRulesList">
                                <div class="empty-state">ÁÇπÂáªÂä†ËΩΩÊåâÈíÆËé∑ÂèñÊ∏∏ÊàèËßÑÂàô</div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="getGameRules()">üîÑ Âä†ËΩΩËßÑÂàô</button>
                            <button class="btn btn-info" onclick="resetAllRules()">üîÑ ÈáçÁΩÆÊâÄÊúâ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÂÆâÂÖ®È™åËØÅ
        class SecurityUtils {
            static validateCommand(command) {
                if (!command || command.length > 1000) {
                    return false;
                }
                
                // Á¶ÅÊ≠¢ÁöÑÂç±Èô©ÂëΩ‰ª§
                const dangerousCommands = [
                    'sudo', 'rm -rf', 'del /f', 'format', 'mkfs', 'dd if=',
                    'shutdown', 'reboot', 'init', 'chmod 777', 'passwd'
                ];
                
                const commandLower = command.toLowerCase();
                for (const dangerous of dangerousCommands) {
                    if (commandLower.includes(dangerous)) {
                        return false;
                    }
                }
                
                return true;
            }
            
            static sanitizeInput(input) {
                if (!input) return '';
                
                const replacements = {
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#x27;',
                    '&': '&amp;',
                    '/': '&#x2F;',
                    '`': '&#x60;',
                    '=': '&#x3D;'
                };
                
                return input.replace(/[<>&"'`=/]/g, char => replacements[char] || char);
            }
            
            static validateUsername(username) {
                if (!username || username.length > 50) {
                    return false;
                }
                return /^[a-zA-Z0-9_-]+$/.test(username);
            }
        }

        // ÂÖ®Â±ÄÂèòÈáè
        let ws = null;
        let sessionId = null;
        let requestId = 1;
        let pendingRequests = {};
        let isConnected = false;
        let whitelistEnabled = false;
        let rconEnabled = false;
        let serverRunning = false;
        let serverOutputWs = null;
        let statusPollInterval = null;

        // Ê∏∏ÊàèËßÑÂàôÂàÜÁ±ªÊò†Â∞Ñ
        const ruleCategories = {
            'announceAdvancements': 'chat',
            'commandBlockOutput': 'chat',
            'disableElytraMovementCheck': 'player',
            'disableRaids': 'mob',
            'doDaylightCycle': 'gameplay',
            'doEntityDrops': 'gameplay',
            'doFireTick': 'gameplay',
            'doImmediateRespawn': 'player',
            'doInsomnia': 'mob',
            'doLimitedCrafting': 'gameplay',
            'doMobLoot': 'mob',
            'doMobSpawning': 'mob',
            'doPatrolSpawning': 'mob',
            'doTileDrops': 'gameplay',
            'doTraderSpawning': 'mob',
            'doWeatherCycle': 'gameplay',
            'drowningDamage': 'player',
            'fallDamage': 'player',
            'fireDamage': 'player',
            'forgiveDeadPlayers': 'mob',
            'freezeDamage': 'player',
            'keepInventory': 'player',
            'logAdminCommands': 'chat',
            'maxCommandChainLength': 'world',
            'maxEntityCramming': 'world',
            'mobGriefing': 'gameplay',
            'naturalRegeneration': 'player',
            'playersSleepingPercentage': 'player',
            'randomTickSpeed': 'world',
            'reducedDebugInfo': 'player',
            'sendCommandFeedback': 'chat',
            'showDeathMessages': 'player',
            'spawnRadius': 'player',
            'spectatorsGenerateChunks': 'world',
            'universalAnger': 'mob',
            'allowEnteringNetherUsingPortals': 'gameplay',
            'allowFireTicksAwayFromPlayer': 'gameplay',
            'blockExplosionDropDecay': 'gameplay',
            'commandBlocksEnabled': 'gameplay',
            'commandModificationBlockLimit': 'world',
            'disablePlayerMovementCheck': 'player',
            'doVinesSpread': 'world',
            'doWardenSpawning': 'mob',
            'enderPearlsVanishOnDeath': 'player',
            'globalSoundEvents': 'gameplay',
            'lavaSourceConversion': 'world',
            'locatorBar': 'player',
            'maxCommandForkCount': 'world',
            'mobExplosionDropDecay': 'gameplay',
            'playersNetherPortalCreativeDelay': 'player',
            'playersNetherPortalDefaultDelay': 'player',
            'projectilesCanBreakBlocks': 'gameplay',
            'pvp': 'player',
            'snowAccumulationHeight': 'world',
            'spawnMonsters': 'mob',
            'spawnerBlocksEnabled': 'gameplay',
            'tntExplodes': 'gameplay',
            'tntExplosionDropDecay': 'gameplay',
            'waterSourceConversion': 'world'
        };

        // ËßÑÂàôÊèèËø∞
        const ruleDescriptions = {
            'announceAdvancements': 'ÊòØÂê¶Âú®ËÅäÂ§©Ê†è‰∏≠ÂÖ¨ÂëäÁé©ÂÆ∂Ëé∑ÂæóÁöÑËøõÂ∫¶',
            'commandBlockOutput': 'ÂëΩ‰ª§ÊñπÂùóÊâßË°åÂëΩ‰ª§Êó∂ÊòØÂê¶Âú®ËÅäÂ§©Ê†èÊòæÁ§∫',
            'disableElytraMovementCheck': 'ÊòØÂê¶Á¶ÅÁî®ÈûòÁøÖÁßªÂä®Ê£ÄÊü•ÔºàÂèØÁî®‰∫éÂèç‰ΩúÂºäÔºâ',
            'disableRaids': 'ÊòØÂê¶Á¶ÅÁî®Ë¢≠Âáª‰∫ã‰ª∂',
            'doDaylightCycle': 'ÊòØÂê¶ËøõË°åÊòºÂ§ú‰∫§Êõø',
            'doEntityDrops': 'ÂÆû‰ΩìÊ≠ª‰∫°Êó∂ÊòØÂê¶ÊéâËêΩÁâ©ÂìÅ',
            'doFireTick': 'ÁÅ´ÊòØÂê¶‰ºöËîìÂª∂ÂíåËá™ÁÑ∂ÁÜÑÁÅ≠',
            'doImmediateRespawn': 'Ê≠ª‰∫°ÂêéÊòØÂê¶Á´ãÂç≥ÈáçÁîüÔºàË∑≥ËøáÊ≠ª‰∫°ÁïåÈù¢Ôºâ',
            'doInsomnia': 'ÊòØÂê¶ÁîüÊàêÂπªÁøºÔºàÂ§±Áú†Êú∫Âà∂Ôºâ',
            'doLimitedCrafting': 'Áé©ÂÆ∂ÊòØÂê¶Âè™ËÉΩÂêàÊàêÂ∑≤Ëß£ÈîÅÁöÑÈÖçÊñπ',
            'doMobLoot': 'ÁîüÁâ©Ê≠ª‰∫°Êó∂ÊòØÂê¶ÊéâËêΩÊàòÂà©ÂìÅ',
            'doMobSpawning': 'ÊòØÂê¶Ëá™ÁÑ∂ÁîüÊàêÁîüÁâ©',
            'doPatrolSpawning': 'ÊòØÂê¶ÁîüÊàêÁÅæÂéÑÂ∑°ÈÄªÈòü',
            'doTileDrops': 'Á†¥ÂùèÊñπÂùóÊó∂ÊòØÂê¶ÊéâËêΩÁâ©ÂìÅ',
            'doTraderSpawning': 'ÊòØÂê¶ÁîüÊàêÊµÅÊµ™ÂïÜ‰∫∫',
            'doWeatherCycle': 'ÊòØÂê¶ËøõË°åÂ§©Ê∞îÂèòÂåñ',
            'drowningDamage': 'Áé©ÂÆ∂ÊòØÂê¶‰ºöÂèóÂà∞Ê∫∫Ê∞¥‰º§ÂÆ≥',
            'fallDamage': 'Áé©ÂÆ∂ÊòØÂê¶‰ºöÂèóÂà∞ÊëîËêΩ‰º§ÂÆ≥',
            'fireDamage': 'Áé©ÂÆ∂ÊòØÂê¶‰ºöÂèóÂà∞ÁÅ´ÁÑ∞‰º§ÂÆ≥',
            'forgiveDeadPlayers': '‰∏≠Á´ãÁîüÁâ©Âú®ÁõÆÊ†áÁé©ÂÆ∂Ê≠ª‰∫°ÂêéÊòØÂê¶ÂÅúÊ≠¢ÊÑ§ÊÄí',
            'freezeDamage': 'Áé©ÂÆ∂Âú®Á≤âÊú´Èõ™‰∏≠ÊòØÂê¶‰ºöÂèóÂà∞ÂÜ∞ÂÜª‰º§ÂÆ≥',
            'keepInventory': 'Ê≠ª‰∫°ÂêéÊòØÂê¶‰øùÁïôÁâ©ÂìÅÊ†èÂíåÁªèÈ™å',
            'logAdminCommands': 'ÊòØÂê¶Âú®ÊúçÂä°Âô®Êó•Âøó‰∏≠ËÆ∞ÂΩïÁÆ°ÁêÜÂëòÊâßË°åÁöÑÂëΩ‰ª§',
            'maxCommandChainLength': 'ÂëΩ‰ª§ÊñπÂùóÈìæÊâßË°åÁöÑÊúÄÂ§ßÈïøÂ∫¶',
            'maxEntityCramming': 'ÂÆû‰ΩìÊå§Âéã‰º§ÂÆ≥ÈòàÂÄºÔºàÂêå‰ΩçÁΩÆÊúÄÂ§öÂÆû‰ΩìÊï∞Ôºâ',
            'mobGriefing': 'ÁîüÁâ©ÊòØÂê¶‰ºöÁ†¥ÂùèÂú∞ÂΩ¢ÂíåÊç°Ëµ∑Áâ©ÂìÅ',
            'naturalRegeneration': 'Áé©ÂÆ∂È••È•øÂÄºÊª°Êó∂ÊòØÂê¶Ëá™ÁÑ∂ÂõûÂ§çÁîüÂëΩÂÄº',
            'playersSleepingPercentage': 'Ë∑≥ËøáÂ§úÊôöÊâÄÈúÄÁöÑÂÖ•Áù°Áé©ÂÆ∂ÁôæÂàÜÊØî',
            'randomTickSpeed': 'ÈöèÊú∫ÂàªÈÄüÂ∫¶ÔºàÂΩ±Âìç‰ΩúÁâ©ÁîüÈïø„ÄÅÊ†ëÂè∂ËÖêÁÉÇÁ≠âÔºâ',
            'reducedDebugInfo': 'ÊòØÂê¶ÂáèÂ∞ëF3Ë∞ÉËØïÂ±èÂπïÊòæÁ§∫ÁöÑ‰ø°ÊÅØ',
            'sendCommandFeedback': 'ÊòØÂê¶ÊòæÁ§∫ÂëΩ‰ª§ÊâßË°åÂèçÈ¶à',
            'showDeathMessages': 'ÊòØÂê¶Âú®ËÅäÂ§©Ê†èÊòæÁ§∫Áé©ÂÆ∂Ê≠ª‰∫°‰ø°ÊÅØ',
            'spawnRadius': 'Áé©ÂÆ∂Ê≠ª‰∫°ÂêéÁöÑÈáçÁîü‰øùÊä§ÂçäÂæÑ',
            'spectatorsGenerateChunks': 'ËßÇÂØüËÄÖÊ®°ÂºèÁöÑÁé©ÂÆ∂ÊòØÂê¶ËÉΩÂ§üÂä†ËΩΩÂå∫Âùó',
            'universalAnger': '‰∏≠Á´ãÁîüÁâ©ÊòØÂê¶‰ºöÂØπ‰ªª‰ΩïÁé©ÂÆ∂ÊÑ§ÊÄíÔºàËÄå‰∏ç‰ªÖÊòØÊîªÂáªËÄÖÔºâ',
            'allowEnteringNetherUsingPortals': 'ÊòØÂê¶ÂÖÅËÆ∏Áé©ÂÆ∂ÈÄöËøá‰∏ãÁïå‰º†ÈÄÅÈó®ËøõÂÖ•‰∏ãÁïå',
            'allowFireTicksAwayFromPlayer': 'ÊòØÂê¶Âú®Áé©ÂÆ∂ËøúÁ¶ªÊó∂ÁªßÁª≠ËÆ°ÁÆóÁÅ´ÁÑ∞ËîìÂª∂',
            'blockExplosionDropDecay': 'ÊñπÂùóÁàÜÁÇ∏Êó∂ÊòØÂê¶Ê†πÊçÆÁàÜÁÇ∏Ë∑ùÁ¶ªË°∞ÂáèÊéâËêΩÁâ©',
            'commandBlocksEnabled': 'ÊòØÂê¶ÂêØÁî®ÂëΩ‰ª§ÊñπÂùó',
            'commandModificationBlockLimit': 'ÂëΩ‰ª§ÊñπÂùóÈìæ‰∏≠Âçï‰∏™ÂëΩ‰ª§ÂèØ‰ª•‰øÆÊîπÁöÑÊúÄÂ§ßÊñπÂùóÊï∞Èáè',
            'disablePlayerMovementCheck': 'ÊòØÂê¶Á¶ÅÁî®Áé©ÂÆ∂ÁßªÂä®Ê£ÄÊü•ÔºàÂèØÁî®‰∫éÂèç‰ΩúÂºäÔºâ',
            'doVinesSpread': 'Ëó§ËîìÊòØÂê¶‰ºöËá™ÁÑ∂ËîìÂª∂',
            'doWardenSpawning': 'ÊòØÂê¶ÁîüÊàêÁõëÂÆàËÄÖ',
            'enderPearlsVanishOnDeath': 'Áé©ÂÆ∂Ê≠ª‰∫°Êó∂Êú´ÂΩ±ÁèçÁè†ÊòØÂê¶‰ºöÊ∂àÂ§±',
            'globalSoundEvents': 'ÊòØÂê¶ÂêØÁî®ÂÖ®Â±ÄÂ£∞Èü≥‰∫ã‰ª∂',
            'lavaSourceConversion': 'ÊòØÂê¶ÂÖÅËÆ∏Â≤©ÊµÜÊ∫êÊñπÂùóËΩ¨Êç¢ÔºàÂ¶ÇÈªëÁü≥ÁîüÊàêÔºâ',
            'locatorBar': 'ÊòØÂê¶ÊòæÁ§∫ÂÆö‰ΩçÂô®Âú∞ÂõæÁöÑËøõÂ∫¶Êù°',
            'maxCommandForkCount': 'Âçï‰∏™ÂëΩ‰ª§ÊâßË°åÁöÑÊúÄÂ§ßÂàÜÊîØÊï∞Èáè',
            'mobExplosionDropDecay': 'ÁîüÁâ©ÁàÜÁÇ∏Êó∂ÊòØÂê¶Ê†πÊçÆÁàÜÁÇ∏Ë∑ùÁ¶ªË°∞ÂáèÊéâËêΩÁâ©',
            'playersNetherPortalCreativeDelay': 'ÂàõÈÄ†Ê®°ÂºèÁé©ÂÆ∂ÈÄöËøá‰∏ãÁïå‰º†ÈÄÅÈó®ÁöÑÂÜ∑Âç¥Êó∂Èó¥ÔºàÂàªÔºâ',
            'playersNetherPortalDefaultDelay': 'ÁîüÂ≠òÊ®°ÂºèÁé©ÂÆ∂ÈÄöËøá‰∏ãÁïå‰º†ÈÄÅÈó®ÁöÑÂÜ∑Âç¥Êó∂Èó¥ÔºàÂàªÔºâ',
            'projectilesCanBreakBlocks': 'ÊäõÂ∞ÑÁâ©ÊòØÂê¶ÂèØ‰ª•Á†¥ÂùèÊñπÂùó',
            'pvp': 'ÊòØÂê¶ÂÖÅËÆ∏Áé©ÂÆ∂‰πãÈó¥ÁöÑÊàòÊñóÔºàPvPÔºâ',
            'snowAccumulationHeight': 'Èõ™Â±ÇÁßØÁ¥ØÁöÑÊúÄÂ§ßÈ´òÂ∫¶',
            'spawnMonsters': 'ÊòØÂê¶Ëá™ÁÑ∂ÁîüÊàêÊïåÂØπÁîüÁâ©',
            'spawnerBlocksEnabled': 'ÊòØÂê¶ÂêØÁî®Âà∑ÊÄ™Á¨º',
            'tntExplodes': 'TNTÊòØÂê¶‰ºöÁàÜÁÇ∏',
            'tntExplosionDropDecay': 'TNTÁàÜÁÇ∏Êó∂ÊòØÂê¶Ê†πÊçÆÁàÜÁÇ∏Ë∑ùÁ¶ªË°∞ÂáèÊéâËêΩÁâ©',
            'waterSourceConversion': 'ÊòØÂê¶ÂÖÅËÆ∏Ê∞¥Ê∫êÊñπÂùóËΩ¨Êç¢ÔºàÂ¶ÇÂúÜÁü≥ÂèòÊàêËãîÁü≥Ôºâ'
        };

        // ÈªòËÆ§ÂÄºÊò†Â∞Ñ
        const defaultValues = {
            'announceAdvancements': "true",
            'commandBlockOutput': "true",
            'disableElytraMovementCheck': "false",
            'disableRaids': "false",
            'doDaylightCycle': "true",
            'doEntityDrops': "true",
            'doFireTick': "true",
            'doImmediateRespawn': "false",
            'doInsomnia': "true",
            'doLimitedCrafting': "false",
            'doMobLoot': "true",
            'doMobSpawning': "true",
            'doPatrolSpawning': "true",
            'doTileDrops': "true",
            'doTraderSpawning': "true",
            'doWeatherCycle': "true",
            'drowningDamage': "true",
            'fallDamage': "true",
            'fireDamage': "true",
            'forgiveDeadPlayers': "true",
            'freezeDamage': "true",
            'keepInventory': "false",
            'logAdminCommands': "true",
            'maxCommandChainLength': "65536",
            'maxEntityCramming': "24",
            'mobGriefing': "true",
            'naturalRegeneration': "true",
            'playersSleepingPercentage': "100",
            'randomTickSpeed': "3",
            'reducedDebugInfo': "false",
            'sendCommandFeedback': "true",
            'showDeathMessages': "true",
            'spawnRadius': "10",
            'spectatorsGenerateChunks': "true",
            'universalAnger': "false",
            'allowEnteringNetherUsingPortals': "true",
            'allowFireTicksAwayFromPlayer': "false",
            'blockExplosionDropDecay': "true",
            'commandBlocksEnabled': "true",
            'commandModificationBlockLimit': "32768",
            'disablePlayerMovementCheck': "false",
            'doVinesSpread': "true",
            'doWardenSpawning': "true",
            'enderPearlsVanishOnDeath': "true",
            'globalSoundEvents': "true",
            'lavaSourceConversion': "false",
            'locatorBar': "true",
            'maxCommandForkCount': "65536",
            'mobExplosionDropDecay': "true",
            'playersNetherPortalCreativeDelay': "0",
            'playersNetherPortalDefaultDelay': "80",
            'projectilesCanBreakBlocks': "true",
            'pvp': "true",
            'snowAccumulationHeight': "1",
            'spawnMonsters': "true",
            'spawnerBlocksEnabled': "true",
            'tntExplodes': "true",
            'tntExplosionDropDecay': "false",
            'waterSourceConversion': "true"
        };

        let currentRules = [];

        // ÁôªÂΩïÂäüËÉΩ
        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            // ËæìÂÖ•È™åËØÅ
            if (!SecurityUtils.validateUsername(username)) {
                errorDiv.textContent = 'Áî®Êà∑ÂêçÊ†ºÂºèÊó†ÊïàÔºàÂè™ÂÖÅËÆ∏Â≠óÊØç„ÄÅÊï∞Â≠ó„ÄÅ‰∏ãÂàíÁ∫øÂíåËøûÂ≠óÁ¨¶Ôºâ';
                errorDiv.style.display = 'block';
                return;
            }

            if (!password || password.length < 8) {
                errorDiv.textContent = 'ÂØÜÁ†ÅÈïøÂ∫¶Ëá≥Â∞ë8‰Ωç';
                errorDiv.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        username: SecurityUtils.sanitizeInput(username), 
                        password: SecurityUtils.sanitizeInput(password) 
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    sessionId = result.session;
                    // ÂÆâÂÖ®Âú∞Â≠òÂÇ®‰ºöËØùID
                    localStorage.setItem('mc_session', sessionId);
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('mainInterface').style.display = 'block';
                    errorDiv.style.display = 'none';
                    addLog('‚úÖ ÁôªÂΩïÊàêÂäü', 'success');
                    
                    // ÂºÄÂßãÁä∂ÊÄÅËΩÆËØ¢
                    startStatusPolling();
                } else {
                    errorDiv.textContent = SecurityUtils.sanitizeInput(result.message) || 'ÁôªÂΩïÂ§±Ë¥•';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'ÁôªÂΩïËØ∑Ê±ÇÂ§±Ë¥•: ' + SecurityUtils.sanitizeInput(error.message);
                errorDiv.style.display = 'block';
                console.error('Login error:', error);
            }
        }

        // Ê£ÄÊü•ËÆ§ËØÅÁä∂ÊÄÅ
        async function checkAuth() {
            if (!sessionId) {
                alert('ËØ∑ÂÖàÁôªÂΩï');
                return false;
            }
            
            try {
                const response = await fetch('/api/check', {
                    headers: {
                        'X-Session-ID': sessionId
                    }
                });
                
                const result = await response.json();
                return result.success;
            } catch (error) {
                console.error('Auth check failed:', error);
                return false;
            }
        }

        // ÈÄÄÂá∫ÁôªÂΩï
        function logout() {
            // Ë∞ÉÁî®ÈÄÄÂá∫Êé•Âè£
            if (sessionId) {
                fetch('/api/logout', {
                    method: 'POST',
                    headers: {
                        'X-Session-ID': sessionId
                    }
                }).catch(console.error);
            }
            
            sessionId = null;
            // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®
            localStorage.removeItem('mc_session');
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('mainInterface').style.display = 'none';
            
            // ÂÅúÊ≠¢Áä∂ÊÄÅËΩÆËØ¢
            stopStatusPolling();
            
            if (ws) {
                disconnect();
            }
            addLog('Â∑≤ÂÆâÂÖ®ÈÄÄÂá∫ÁôªÂΩï', 'info');
        }

        // ÂºÄÂßãÁä∂ÊÄÅËΩÆËØ¢
        function startStatusPolling() {
            if (statusPollInterval) {
                clearInterval(statusPollInterval);
            }
            
            statusPollInterval = setInterval(() => {
                if (sessionId) {
                    checkServerStatus();
                    // ÊØè60ÁßíÊ£ÄÊü•‰∏ÄÊ¨°RCONÁä∂ÊÄÅ
                    if (Date.now() % 60000 < 1000) {
                        checkRconStatus();
                    }
                }
            }, 10000); // ÊØè40ÁßíÊ£ÄÊü•‰∏ÄÊ¨°ÊúçÂä°Âô®Áä∂ÊÄÅ
        }

        // ÂÅúÊ≠¢Áä∂ÊÄÅËΩÆËØ¢
        function stopStatusPolling() {
            if (statusPollInterval) {
                clearInterval(statusPollInterval);
                statusPollInterval = null;
            }
        }

        // ËøûÊé•ÊúçÂä°Âô®ËæìÂá∫ÊµÅ
        function connectServerOutput() {
            if (serverOutputWs && serverOutputWs.readyState === WebSocket.OPEN) {
                return;
            }
            
            const host = document.getElementById('wsHost').value;
            const port = document.getElementById('wsPort').value;
            
            try {
                serverOutputWs = new WebSocket(`ws://${host}:${port}/server_output`);
                
                serverOutputWs.onopen = function() {
                    addLog('‚úÖ Â∑≤ËøûÊé•Âà∞ÊúçÂä°Âô®ËæìÂá∫ÊµÅ', 'success');
                };
                
                serverOutputWs.onclose = function() {
                    addLog('‚ùå ÊúçÂä°Âô®ËæìÂá∫ÊµÅËøûÊé•Â∑≤Êñ≠ÂºÄ', 'error');
                };
                
                serverOutputWs.onerror = function(error) {
                    addLog('‚ùå ÊúçÂä°Âô®ËæìÂá∫ÊµÅËøûÊé•ÈîôËØØ', 'error');
                    console.error('Server output WebSocket error:', error);
                };
                
                serverOutputWs.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        if (data.type === 'server_output') {
                            // Âú®ÊéßÂà∂Âè∞Êó•Âøó‰∏≠ÊòæÁ§∫ÊúçÂä°Âô®ËæìÂá∫
                            addLog(data.data, 'info');
                        }
                    } catch (e) {
                        console.log('Êî∂Âà∞ÈùûJSONÊ∂àÊÅØ:', event.data);
                    }
                };
                
            } catch (error) {
                addLog('‚ùå ËøûÊé•ÊúçÂä°Âô®ËæìÂá∫ÊµÅÂ§±Ë¥•: ' + error.message, 'error');
                console.error('Server output connection error:', error);
            }
        }

        // ËøûÊé• WebSocket
        function connect() {
            if (!sessionId) {
                alert('ËØ∑ÂÖàÁôªÂΩï');
                return;
            }
            
            const host = document.getElementById('wsHost').value;
            const port = document.getElementById('wsPort').value;
            
            // È™åËØÅ‰∏ªÊú∫ÂêçÂíåÁ´ØÂè£
            if (!host || !port) {
                addLog('‚ùå ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑ‰∏ªÊú∫ÂêçÂíåÁ´ØÂè£', 'error');
                return;
            }
            
            updateStatus('connecting', 'ËøûÊé•‰∏≠...');
            
            try {
                ws = new WebSocket(`ws://${SecurityUtils.sanitizeInput(host)}:${SecurityUtils.sanitizeInput(port)}`);
                
                ws.onopen = function() {
                    updateStatus('connected', 'Â∑≤ËøûÊé•');
                    isConnected = true;
                    document.getElementById('connectBtn').disabled = true;
                    document.getElementById('disconnectBtn').disabled = false;
                    addLog('‚úÖ Â∑≤ËøûÊé•Âà∞ Minecraft ÊúçÂä°Âô®', 'success');
                    
                    // ËøûÊé•ÊúçÂä°Âô®ËæìÂá∫ÊµÅ
                    connectServerOutput();
                    
                    // ËøûÊé•ÊàêÂäüÂêéËé∑ÂèñÂàùÂßãÊï∞ÊçÆ
                    setTimeout(() => {
                        getPlayers();
                        getWhitelist();
                        getWhitelistStatus();
                        getBans();
                        getIPBans();
                        getAdmins();
                        getGameRules();
                        checkRconStatus();
                    }, 1000);
                    setTimeout(() => {
                        checkServerStatus();
                    }, 1500);
                };
                
                ws.onclose = function() {
                    updateStatus('disconnected', 'ËøûÊé•Êñ≠ÂºÄ');
                    isConnected = false;
                    document.getElementById('connectBtn').disabled = false;
                    document.getElementById('disconnectBtn').disabled = true;
                    addLog('‚ùå ‰∏éÊúçÂä°Âô®ÁöÑËøûÊé•Â∑≤Êñ≠ÂºÄ', 'error');
                };
                
                ws.onerror = function(error) {
                    updateStatus('disconnected', 'ËøûÊé•ÈîôËØØ');
                    addLog('‚ùå ËøûÊé•ÈîôËØØ', 'error');
                    console.error('WebSocket error:', error);
                };
                
                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        handleServerMessage(data);
                    } catch (e) {
                        console.log('Êî∂Âà∞ÈùûJSONÊ∂àÊÅØ:', event.data);
                    }
                };
                
            } catch (error) {
                updateStatus('disconnected', 'ËøûÊé•Â§±Ë¥•');
                addLog('‚ùå ËøûÊé•Â§±Ë¥•: ' + SecurityUtils.sanitizeInput(error.message), 'error');
                console.error('Connection error:', error);
            }
        }

        // Êñ≠ÂºÄËøûÊé•
        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
            
            if (serverOutputWs) {
                serverOutputWs.close();
                serverOutputWs = null;
            }
            
            updateStatus('disconnected', 'Êú™ËøûÊé•');
            document.getElementById('connectBtn').disabled = false;
            document.getElementById('disconnectBtn').disabled = true;
            addLog('Â∑≤Êñ≠ÂºÄËøûÊé•', 'info');
            
            // Êñ≠ÂºÄËøûÊé•Êó∂Êõ¥Êñ∞ RCON Áä∂ÊÄÅ
            rconEnabled = false;
            updateRconStatusDisplay();
        }

        // Êõ¥Êñ∞ËøûÊé•Áä∂ÊÄÅ
        function updateStatus(status, text) {
            const indicator = document.getElementById('statusIndicator');
            indicator.className = `status ${status}`;
            indicator.querySelector('.status-text').textContent = text;
        }

        // Ê∑ªÂä†Êó•Âøó
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            // Ê∏ÖÁêÜËæìÂá∫ÂÜÖÂÆπ
            const safeMessage = SecurityUtils.sanitizeInput(message);
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${safeMessage}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Ê∑ªÂä†‰∫ã‰ª∂
        function addEvent(type, data) {
            const eventsContainer = document.getElementById('eventsContainer');
            const eventItem = document.createElement('div');
            eventItem.className = 'event-item';
            
            const timestamp = new Date().toLocaleTimeString();
            eventItem.innerHTML = `
                <div class="event-time">${timestamp}</div>
                <div class="event-type">${type}</div>
                <div class="event-data">${JSON.stringify(data, null, 2)}</div>
            `;
            
            eventsContainer.appendChild(eventItem);
            eventsContainer.scrollTop = eventsContainer.scrollHeight;
            
            // ÈôêÂà∂‰∫ã‰ª∂Êï∞Èáè
            const events = eventsContainer.querySelectorAll('.event-item');
            if (events.length > 50) {
                events[0].remove();
            }
        }

        // Ê£ÄÊü• RCON Áä∂ÊÄÅ
        async function checkRconStatus() {
            try {
                const response = await fetch('/api/rcon', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId
                    },
                    body: JSON.stringify({ command: 'list' })
                });
                
                const result = await response.json();
                rconEnabled = result.success;
                updateRconStatusDisplay();
                
            } catch (error) {
                rconEnabled = false;
                updateRconStatusDisplay();
            }
        }

        // Êõ¥Êñ∞ RCON Áä∂ÊÄÅÊòæÁ§∫
        function updateRconStatusDisplay() {
            const indicator = document.getElementById('rconStatusIndicator');
            const statusText = document.getElementById('rconStatusText');
            
            if (rconEnabled) {
                indicator.className = 'rcon-indicator on';
                statusText.textContent = 'RCON Áä∂ÊÄÅ: Â∑≤ËøûÊé•';
            } else {
                indicator.className = 'rcon-indicator off';
                statusText.textContent = 'RCON Áä∂ÊÄÅ: Êú™ËøûÊé•';
            }
        }

        // ÊâßË°å RCON ÂëΩ‰ª§
        async function executeRconCommand() {
            const commandInput = document.getElementById('commandInput');
            const command = commandInput.value.trim();
            
            if (!command) return;
            
            if (!rconEnabled) {
                addLog('‚ùå RCON Êú™ÂêØÁî®ÔºåÊó†Ê≥ïÊâßË°åÂëΩ‰ª§', 'error');
                return;
            }
            
            addLog(`üîÑ ÊâßË°åÂëΩ‰ª§: ${command}`, 'info');
            
            try {
                const response = await fetch('/api/rcon', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId
                    },
                    body: JSON.stringify({ command: command })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog(`‚úÖ ÂëΩ‰ª§ÊâßË°åÊàêÂäü: ${result.response}`, 'success');
                } else {
                    addLog(`‚ùå ÂëΩ‰ª§ÊâßË°åÂ§±Ë¥•: ${result.message}`, 'error');
                }
                
                commandInput.value = '';
            } catch (error) {
                addLog(`‚ùå ÂëΩ‰ª§ÊâßË°åÈîôËØØ: ${error.message}`, 'error');
            }
        }

        // Â§ÑÁêÜÂëΩ‰ª§ËæìÂÖ•Ê°ÜÂõûËΩ¶ÈîÆ
        function handleCommandKeypress(event) {
            if (event.key === 'Enter') {
                executeRconCommand();
            }
        }

        // ÂèëÈÄÅ RPC ËØ∑Ê±ÇÔºà‰øùÊåÅÂéüÊúâÂçèËÆÆÊ†ºÂºèÔºâ
        function sendRequest(method, params = []) {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addLog('‚ùå Êú™ËøûÊé•Âà∞ÊúçÂä°Âô®', 'error');
                return Promise.reject(new Error('Êú™ËøûÊé•'));
            }
            
            const id = requestId++;
            const request = {
                jsonrpc: "2.0",
                method: method,
                params: params,
                id: id
            };
            
            return new Promise((resolve, reject) => {
                pendingRequests[id] = { resolve, reject };
                const jsonStr = JSON.stringify(request);
                console.log('ÂèëÈÄÅËØ∑Ê±Ç:', jsonStr);
                ws.send(jsonStr);
                addLog(`ÂèëÈÄÅËØ∑Ê±Ç: ${method}`, 'info');
                
                // ËÆæÁΩÆË∂ÖÊó∂
                setTimeout(() => {
                    if (pendingRequests[id]) {
                        delete pendingRequests[id];
                        reject(new Error('ËØ∑Ê±ÇË∂ÖÊó∂'));
                        addLog(`ËØ∑Ê±ÇË∂ÖÊó∂: ${method}`, 'error');
                    }
                }, 10000);
            });
        }

        // Â§ÑÁêÜÊúçÂä°Âô®Ê∂àÊÅØ
        function handleServerMessage(data) {
            console.log('Êî∂Âà∞Ê∂àÊÅØ:', data);
            
            if (data.id && pendingRequests[data.id]) {
                const { resolve, reject } = pendingRequests[data.id];
                delete pendingRequests[data.id];
                
                if (data.error) {
                    addLog(`ÈîôËØØ [${data.error.code}]: ${data.error.message}`, 'error');
                    reject(data.error);
                } else {
                    addLog(`Êî∂Âà∞ÂìçÂ∫î`, 'success');
                    resolve(data.result);
                }
            } else if (data.method) {
                // Â§ÑÁêÜÊúçÂä°Âô®Êé®ÈÄÅÁöÑ‰∫ã‰ª∂
                addEvent(data.method, data.params);
                addLog(`Êî∂Âà∞‰∫ã‰ª∂: ${data.method}`, 'info');
                
                // Â§ÑÁêÜÁâπÂÆö‰∫ã‰ª∂
                switch (data.method) {
                    case 'minecraft:notification/players/joined':
                        if (data.params && data.params[0]) {
                            addLog(`üéÆ Áé©ÂÆ∂ ${data.params[0].name} Âä†ÂÖ•‰∫ÜÊ∏∏Êàè`, 'success');
                            getPlayers();
                        }
                        break;
                    case 'minecraft:notification/players/left':
                        if (data.params && data.params[0]) {
                            addLog(`üö™ Áé©ÂÆ∂ ${data.params[0].name} Á¶ªÂºÄ‰∫ÜÊ∏∏Êàè`, 'warning');
                            getPlayers();
                        }
                        break;
                    case 'minecraft:notification/server/saving':
                        addLog('üíæ ÊúçÂä°Âô®Ê≠£Âú®‰øùÂ≠ò‰∏ñÁïå...', 'warning');
                        break;
                    case 'minecraft:notification/server/saved':
                        addLog('‚úÖ ‰∏ñÁïå‰øùÂ≠òÂÆåÊàê', 'success');
                        break;
                }
            }
        }

        // Ëé∑ÂèñÂú®Á∫øÁé©ÂÆ∂
        function getPlayers() {
            sendRequest('players', [])
                .then(players => {
                    displayPlayers(players);
                    addLog(`Ëé∑ÂèñÂà∞ ${players.length} ÂêçÂú®Á∫øÁé©ÂÆ∂`, 'success');
                })
                .catch(error => {
                    addLog('Ëé∑ÂèñÁé©ÂÆ∂ÂàóË°®Â§±Ë¥•: ' + error.message, 'error');
                });
        }

        // ÊòæÁ§∫Áé©ÂÆ∂ÂàóË°® - ‰ΩøÁî®Á¥ßÂáëÊ†∑Âºè
        function displayPlayers(players) {
            const playersList = document.getElementById('playersList');
            
            if (!players || players.length === 0) {
                playersList.innerHTML = '<li class="empty-state">Ê≤°ÊúâÂú®Á∫øÁé©ÂÆ∂</li>';
                return;
            }
            
            playersList.innerHTML = players.map(player => `
                <li class="compact-player-item" data-name="${player.name.toLowerCase()}">
                    <div class="compact-player-info">
                        <div class="compact-player-name">${player.name}</div>
                        <div class="compact-player-uuid">${player.id}</div>
                    </div>
                    <div class="compact-player-actions">
                        <button class="btn btn-danger btn-small" onclick="kickPlayer('${player.name}', '${player.id}')">Ë∏¢Âá∫</button>
                    </div>
                </li>
            `).join('');
        }

        // Á≠õÈÄâÁé©ÂÆ∂
        function filterPlayers() {
            const search = document.getElementById('playersSearch').value.toLowerCase();
            const items = document.querySelectorAll('#playersList .compact-player-item');
            
            items.forEach(item => {
                const playerName = item.getAttribute('data-name');
                if (playerName.includes(search)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Ë∏¢Âá∫Áé©ÂÆ∂
        function kickPlayer(playerName, playerId) {
            if (!confirm(`Á°ÆÂÆöË¶ÅË∏¢Âá∫Áé©ÂÆ∂ ${playerName} ÂêóÔºü`)) return;
            
            const kickParams = {
                message: "ÊÇ®Â∑≤Ë¢´ÁÆ°ÁêÜÂëòË∏¢Âá∫ÊúçÂä°Âô®",
                player: [{ 
                    name: playerName, 
                    id: playerId 
                }]
            };
            
            addLog(`üîÑ Ê≠£Âú®Ë∏¢Âá∫Áé©ÂÆ∂: ${playerName}`, 'info');
            
            sendRequest('players/kick', [kickParams])
            .then((kickedPlayers) => {
                if (kickedPlayers && kickedPlayers.length > 0) {
                    addLog(`‚úÖ Â∑≤ÊàêÂäüË∏¢Âá∫Áé©ÂÆ∂: ${playerName}`, 'success');
                } else {
                    addLog(`‚ö†Ô∏è Áé©ÂÆ∂ ${playerName} ÂèØËÉΩ‰∏çÂú®Á∫ø`, 'warning');
                }
                // Á´ãÂç≥Âà∑Êñ∞Áé©ÂÆ∂ÂàóË°®
                setTimeout(() => getPlayers(), 1000);
            })
            .catch(error => {
                let errorMsg = error.message;
                if (error.code === -32602) {
                    errorMsg = "ÂèÇÊï∞Ê†ºÂºèÈîôËØØ";
                } else if (error.code === -32601) {
                    errorMsg = "ÊñπÊ≥ï‰∏çÂ≠òÂú®";
                }
                addLog(`‚ùå Ë∏¢Âá∫Áé©ÂÆ∂Â§±Ë¥•: ${playerName} - ${errorMsg}`, 'error');
            });
        }

        // ‰øùÂ≠ò‰∏ñÁïå
        function saveAll() {
            sendRequest('server/save', [true])
                .then(() => {
                    addLog('‰∏ñÁïåÂ∑≤‰øùÂ≠ò', 'success');
                })
                .catch(error => {
                    addLog('‰øùÂ≠ò‰∏ñÁïåÂ§±Ë¥•: ' + error.message, 'error');
                });
        }

        // ÂÅúÊ≠¢ÊúçÂä°Âô®
        function stopServer() {
            if (!confirm('Á°ÆÂÆöË¶ÅÂÅúÊ≠¢ÊúçÂä°Âô®ÂêóÔºüËøôÂ∞ÜÊñ≠ÂºÄÊâÄÊúâÁé©ÂÆ∂ËøûÊé•ÔºÅ')) return;
            
            sendRequest('server/stop', [])
                .then(() => {
                    addLog('ÊúçÂä°Âô®Ê≠£Âú®ÂÖ≥Èó≠...', 'warning');
                    // ÂÅúÊ≠¢ÂêéÂª∂ËøüÊ£ÄÊü•Áä∂ÊÄÅ
                    setTimeout(() => {
                        checkServerStatus();
                        checkRconStatus();
                    }, 3000);
                })
                .catch(error => {
                    addLog('ÂÅúÊ≠¢ÊúçÂä°Âô®Â§±Ë¥•: ' + error.message, 'error');
                });
        }

        // Ê∏ÖÁ©∫Êó•Âøó
        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            addLog('Êó•ÂøóÂ∑≤Ê∏ÖÁ©∫', 'info');
        }

        // Ê∏ÖÁ©∫‰∫ã‰ª∂
        function clearEvents() {
            document.getElementById('eventsContainer').innerHTML = '<div class="empty-state">ÊúçÂä°Âô®‰∫ã‰ª∂Â∞ÜÂú®ËøôÈáåÊòæÁ§∫</div>';
        }

        // Ê†áÁ≠æÈ°µÂàáÊç¢
        function switchTab(tabName) {
            // ÈöêËóèÊâÄÊúâÊ†áÁ≠æÂÜÖÂÆπ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ÂèñÊ∂àÊâÄÊúâÊ†áÁ≠æÊøÄÊ¥ªÁä∂ÊÄÅ
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ÊøÄÊ¥ªÈÄâ‰∏≠ÁöÑÊ†áÁ≠æ
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
        }

        // ÁôΩÂêçÂçïÂäüËÉΩ
        function getWhitelistStatus() {
            sendRequest('serversettings/use_allowlist', [])
                .then(result => {
                    whitelistEnabled = result;
                    updateWhitelistStatusDisplay();
                    addLog(`ÁôΩÂêçÂçïÁä∂ÊÄÅ: ${whitelistEnabled ? 'Â∑≤ÂêØÁî®' : 'Â∑≤Á¶ÅÁî®'}`, 'success');
                })
                .catch(error => {
                    addLog('Ëé∑ÂèñÁôΩÂêçÂçïÁä∂ÊÄÅÂ§±Ë¥•: ' + error.message, 'error');
                });
        }

        function updateWhitelistStatusDisplay() {
            const indicator = document.getElementById('whitelistStatusIndicator');
            const statusText = document.getElementById('whitelistStatusText');
            const enableBtn = document.getElementById('enableWhitelistBtn');
            const disableBtn = document.getElementById('disableWhitelistBtn');
            
            if (whitelistEnabled) {
                indicator.className = 'status-indicator on';
                statusText.textContent = 'ÁôΩÂêçÂçïÂ∑≤ÂêØÁî®';
                enableBtn.disabled = true;
                disableBtn.disabled = false;
                enableBtn.innerHTML = '‚úÖ Â∑≤ÂêØÁî®';
                disableBtn.innerHTML = '‚ùå ÂÖ≥Èó≠ÁôΩÂêçÂçï';
            } else {
                indicator.className = 'status-indicator off';
                statusText.textContent = 'ÁôΩÂêçÂçïÂ∑≤Á¶ÅÁî®';
                enableBtn.disabled = false;
                disableBtn.disabled = true;
                enableBtn.innerHTML = '‚úÖ ÂêØÁî®ÁôΩÂêçÂçï';
                disableBtn.innerHTML = '‚ùå Â∑≤ÂÖ≥Èó≠';
            }
        }

        function toggleWhitelist(enable) {
            sendRequest('serversettings/use_allowlist/set', [enable])
                .then(() => {
                    whitelistEnabled = enable;
                    updateWhitelistStatusDisplay();
                    addLog(`ÁôΩÂêçÂçïÂ∑≤${enable ? 'ÂêØÁî®' : 'ÂÖ≥Èó≠'}`, 'success');
                })
                .catch(error => {
                    addLog(`${enable ? 'ÂêØÁî®' : 'ÂÖ≥Èó≠'}ÁôΩÂêçÂçïÂ§±Ë¥•: ${error.message}`, 'error');
                });
        }

        function getWhitelist() {
            sendRequest('allowlist', [])
                .then(whitelist => {
                    displayWhitelist(whitelist);
                    addLog(`Ëé∑ÂèñÂà∞ ${whitelist.length} ‰∏™ÁôΩÂêçÂçïÁé©ÂÆ∂`, 'success');
                })
                .catch(error => {
                    addLog('Ëé∑ÂèñÁôΩÂêçÂçïÂ§±Ë¥•: ' + error.message, 'error');
                });
        }

        function displayWhitelist(whitelist) {
            const container = document.getElementById('whitelistContainer');
            
            if (!whitelist || whitelist.length === 0) {
                container.innerHTML = '<div class="empty-state">ÁôΩÂêçÂçï‰∏∫Á©∫</div>';
                return;
            }
            
            container.innerHTML = whitelist.map(player => `
                <div class="compact-player-item" data-name="${player.name.toLowerCase()}">
                    <div class="compact-player-info">
                        <div class="compact-player-name">‚úì ${player.name}</div>
                        <div class="compact-player-uuid">${player.id}</div>
                    </div>
                    <div class="compact-player-actions">
                        <button class="btn btn-danger btn-small" onclick="removeFromWhitelist('${player.name}', '${player.id}')">ÁßªÈô§</button>
                    </div>
                </div>
            `).join('');
        }

        function addToWhitelist() {
            const playerName = document.getElementById('addWhitelistPlayer').value.trim();
            if (!playerName) {
                alert('ËØ∑ËæìÂÖ•Áé©ÂÆ∂ÂêçÁß∞');
                return;
            }
            
            sendRequest('allowlist/add', [[{ name: playerName }]])
                .then(() => {
                    addLog(`Â∑≤Â∞Ü ${playerName} Ê∑ªÂä†Âà∞ÁôΩÂêçÂçï`, 'success');
                    document.getElementById('addWhitelistPlayer').value = '';
                    getWhitelist();
                })
                .catch(error => {
                    addLog(`Ê∑ªÂä†ÁôΩÂêçÂçïÂ§±Ë¥•: ${playerName} - ${error.message}`, 'error');
                });
        }

        function removeFromWhitelist(playerName, playerId) {
            if (!confirm(`Á°ÆÂÆöË¶Å‰ªéÁôΩÂêçÂçïÁßªÈô§ ${playerName} ÂêóÔºü`)) return;
            
            sendRequest('allowlist/remove', [[{ name: playerName, id: playerId }]])
                .then(() => {
                    addLog(`Â∑≤‰ªéÁôΩÂêçÂçïÁßªÈô§: ${playerName}`, 'success');
                    getWhitelist();
                })
                .catch(error => {
                    addLog(`ÁßªÈô§ÁôΩÂêçÂçïÂ§±Ë¥•: ${playerName} - ${error.message}`, 'error');
                });
        }

        function filterWhitelist() {
            const search = document.getElementById('whitelistSearch').value.toLowerCase();
            const items = document.querySelectorAll('#whitelistContainer .compact-player-item');
            
            items.forEach(item => {
                const playerName = item.getAttribute('data-name');
                if (playerName.includes(search)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Â∞ÅÁ¶ÅÁÆ°ÁêÜÂäüËÉΩ
        function getBans() {
            sendRequest('bans', [])
                .then(bans => {
                    displayBans(bans);
                    addLog(`Ëé∑ÂèñÂà∞ ${bans.length} ‰∏™Áé©ÂÆ∂Â∞ÅÁ¶Å`, 'success');
                })
                .catch(error => {
                    addLog('Ëé∑ÂèñÂ∞ÅÁ¶ÅÂàóË°®Â§±Ë¥•: ' + error.message, 'error');
                });
        }

        function getIPBans() {
            sendRequest('ip_bans', [])
                .then(ipBans => {
                    displayIPBans(ipBans);
                    addLog(`Ëé∑ÂèñÂà∞ ${ipBans.length} ‰∏™IPÂ∞ÅÁ¶Å`, 'success');
                })
                .catch(error => {
                    addLog('Ëé∑ÂèñIPÂ∞ÅÁ¶ÅÂàóË°®Â§±Ë¥•: ' + error.message, 'error');
                });
        }

        function displayBans(bans) {
            const container = document.getElementById('bansContainer');
            
            if (!bans || bans.length === 0) {
                container.innerHTML = '<div class="empty-state">Áé©ÂÆ∂Â∞ÅÁ¶ÅÂàóË°®‰∏∫Á©∫</div>';
                return;
            }
            
            const bansHTML = bans.map(ban => `
                <div class="compact-player-item" data-name="${ban.player.name.toLowerCase()}">
                    <div class="compact-player-info">
                        <div class="compact-player-name">üö´ ${ban.player.name}</div>
                        <div class="compact-player-uuid">${ban.player.id}</div>
                        ${ban.reason ? `<div style="color: var(--danger); font-size: 0.7rem; margin-top: 2px;">ÂéüÂõ†: ${ban.reason}</div>` : ''}
                        ${ban.source ? `<div style="color: #888; font-size: 0.6rem; margin-top: 1px;">Êìç‰ΩúËÄÖ: ${ban.source}</div>` : ''}
                    </div>
                    <div class="compact-player-actions">
                        <button class="btn btn-success btn-small" onclick="unbanPlayer('${ban.player.name}', '${ban.player.id}')">Ëß£Â∞Å</button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = '<h4 style="margin-bottom: 10px; color: var(--dark);">Áé©ÂÆ∂Â∞ÅÁ¶ÅÂàóË°®</h4>' + bansHTML;
        }

        function displayIPBans(ipBans) {
            const container = document.getElementById('bansContainer');
            let existingContent = container.innerHTML;
            
            if (!ipBans || ipBans.length === 0) {
                container.innerHTML = existingContent + '<h4 style="margin-top: 15px; color: var(--dark);">IPÂ∞ÅÁ¶ÅÂàóË°®</h4><div class="empty-state">IPÂ∞ÅÁ¶ÅÂàóË°®‰∏∫Á©∫</div>';
                return;
            }
            
            const ipBansHTML = ipBans.map(ban => `
                <div class="compact-player-item" data-ip="${ban.ip}">
                    <div class="compact-player-info">
                        <div class="compact-player-name">üåê ${ban.ip}</div>
                        ${ban.reason ? `<div style="color: var(--danger); font-size: 0.7rem; margin-top: 2px;">ÂéüÂõ†: ${ban.reason}</div>` : ''}
                        ${ban.source ? `<div style="color: #888; font-size: 0.6rem; margin-top: 1px;">Êìç‰ΩúËÄÖ: ${ban.source}</div>` : ''}
                    </div>
                    <div class="compact-player-actions">
                        <button class="btn btn-success btn-small" onclick="unbanIP('${ban.ip}')">Ëß£Â∞Å</button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = existingContent + '<h4 style="margin-top: 15px; color: var(--dark);">IPÂ∞ÅÁ¶ÅÂàóË°®</h4>' + ipBansHTML;
        }

        function banPlayer() {
            const playerName = document.getElementById('banPlayerName').value.trim();
            const reason = document.getElementById('banReason').value.trim();
            
            if (!playerName) {
                alert('ËØ∑ËæìÂÖ•Áé©ÂÆ∂ÂêçÁß∞');
                return;
            }
            
            if (!confirm(`Á°ÆÂÆöË¶ÅÂ∞ÅÁ¶ÅÁé©ÂÆ∂ ${playerName} ÂêóÔºü`)) return;
            
            sendRequest('bans/add', [[{
                player: { name: playerName },
                reason: reason || "ËøùÂèçÊúçÂä°Âô®ËßÑÂàô",
                source: "ÁÆ°ÁêÜÈù¢Êùø"
            }]])
                .then(() => {
                    addLog(`Â∑≤Â∞ÅÁ¶ÅÁé©ÂÆ∂: ${playerName}`, 'success');
                    document.getElementById('banPlayerName').value = '';
                    document.getElementById('banReason').value = '';
                    getBans();
                })
                .catch(error => {
                    addLog(`Â∞ÅÁ¶ÅÁé©ÂÆ∂Â§±Ë¥•: ${playerName} - ${error.message}`, 'error');
                });
        }

        function banIP() {
            const ip = document.getElementById('banIP').value.trim();
            const reason = document.getElementById('banIPReason').value.trim();
            
            if (!ip) {
                alert('ËØ∑ËæìÂÖ•IPÂú∞ÂùÄ');
                return;
            }
            
            if (!confirm(`Á°ÆÂÆöË¶ÅÂ∞ÅÁ¶ÅIP ${ip} ÂêóÔºü`)) return;
            
            sendRequest('ip_bans/add', [[{
                ip: ip,
                reason: reason || "ËøùÂèçÊúçÂä°Âô®ËßÑÂàô",
                source: "ÁÆ°ÁêÜÈù¢Êùø"
            }]])
                .then(() => {
                    addLog(`Â∑≤Â∞ÅÁ¶ÅIP: ${ip}`, 'success');
                    document.getElementById('banIP').value = '';
                    document.getElementById('banIPReason').value = '';
                    getIPBans();
                })
                .catch(error => {
                    addLog(`Â∞ÅÁ¶ÅIPÂ§±Ë¥•: ${ip} - ${error.message}`, 'error');
                });
        }

        function unbanPlayer(playerName, playerId) {
            if (!confirm(`Á°ÆÂÆöË¶ÅËß£Â∞Å ${playerName} ÂêóÔºü`)) return;
            
            sendRequest('bans/remove', [[{ name: playerName, id: playerId }]])
                .then(() => {
                    addLog(`Â∑≤Ëß£Â∞ÅÁé©ÂÆ∂: ${playerName}`, 'success');
                    getBans();
                })
                .catch(error => {
                    addLog(`Ëß£Â∞ÅÁé©ÂÆ∂Â§±Ë¥•: ${playerName} - ${error.message}`, 'error');
                });
        }

        function unbanIP(ip) {
            if (!confirm(`Á°ÆÂÆöË¶ÅËß£Â∞ÅIP ${ip} ÂêóÔºü`)) return;
            
            sendRequest('ip_bans/remove', [[ip]])
                .then(() => {
                    addLog(`Â∑≤Ëß£Â∞ÅIP: ${ip}`, 'success');
                    getIPBans();
                })
                .catch(error => {
                    addLog(`Ëß£Â∞ÅIPÂ§±Ë¥•: ${ip} - ${error.message}`, 'error');
                });
        }

        function filterBans() {
            const search = document.getElementById('bansSearch').value.toLowerCase();
            const items = document.querySelectorAll('#bansContainer .compact-player-item');
            
            items.forEach(item => {
                const name = item.getAttribute('data-name');
                const ip = item.getAttribute('data-ip');
                const searchText = (name || ip || '').toLowerCase();
                
                if (searchText.includes(search)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // ÁÆ°ÁêÜÂëòÁÆ°ÁêÜÂäüËÉΩ
        function getAdmins() {
            sendRequest('operators', [])
                .then(admins => {
                    displayAdmins(admins);
                    addLog(`Ëé∑ÂèñÂà∞ ${admins.length} ÂêçÁÆ°ÁêÜÂëò`, 'success');
                })
                .catch(error => {
                    addLog('Ëé∑ÂèñÁÆ°ÁêÜÂëòÂàóË°®Â§±Ë¥•: ' + error.message, 'error');
                });
        }

        function displayAdmins(admins) {
            const container = document.getElementById('adminsContainer');
            
            if (!admins || admins.length === 0) {
                container.innerHTML = '<div class="empty-state">ÊöÇÊó†ÁÆ°ÁêÜÂëò</div>';
                return;
            }
            
            container.innerHTML = admins.map(admin => `
                <div class="compact-player-item" data-name="${admin.player.name.toLowerCase()}">
                    <div class="compact-player-info">
                        <div class="compact-player-name">üëë ${admin.player.name}</div>
                        <div class="compact-player-uuid">${admin.player.id}</div>
                        <div style="color: #666; font-size: 0.7rem;">ÊùÉÈôêÁ≠âÁ∫ß: ${admin.permissionLevel}</div>
                    </div>
                    <div class="compact-player-actions">
                        <button class="btn btn-danger btn-small" onclick="removeAdmin('${admin.player.name}', '${admin.player.id}')">ÁßªÈô§</button>
                    </div>
                </div>
            `).join('');
        }

        function addAdmin() {
            const playerName = document.getElementById('addAdminPlayer').value.trim();
            const level = parseInt(document.getElementById('adminLevel').value);
            
            if (!playerName) {
                alert('ËØ∑ËæìÂÖ•Áé©ÂÆ∂ÂêçÁß∞');
                return;
            }
            
            if (isNaN(level) || level < 0 || level > 4) {
                alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊùÉÈôêÁ≠âÁ∫ß (0-4)');
                return;
            }
            
            sendRequest('operators/add', [[{
                player: { name: playerName },
                permissionLevel: level,
                bypassesPlayerLimit: true
            }]])
                .then(() => {
                    addLog(`Â∑≤Â∞Ü ${playerName} ËÆæÁΩÆ‰∏∫ÁÆ°ÁêÜÂëò`, 'success');
                    document.getElementById('addAdminPlayer').value = '';
                    getAdmins();
                })
                .catch(error => {
                    addLog(`ËÆæÁΩÆÁÆ°ÁêÜÂëòÂ§±Ë¥•: ${playerName} - ${error.message}`, 'error');
                });
        }

        function removeAdmin(playerName, playerId) {
            if (!confirm(`Á°ÆÂÆöË¶ÅÁßªÈô§ÁÆ°ÁêÜÂëò ${playerName} ÂêóÔºü`)) return;
            
            sendRequest('operators/remove', [[{ name: playerName, id: playerId }]])
                .then(() => {
                    addLog(`Â∑≤ÁßªÈô§ÁÆ°ÁêÜÂëò: ${playerName}`, 'success');
                    getAdmins();
                })
                .catch(error => {
                    addLog(`ÁßªÈô§ÁÆ°ÁêÜÂëòÂ§±Ë¥•: ${playerName} - ${error.message}`, 'error');
                });
        }

        function filterAdmins() {
            const search = document.getElementById('adminsSearch').value.toLowerCase();
            const items = document.querySelectorAll('#adminsContainer .compact-player-item');
            
            items.forEach(item => {
                const playerName = item.getAttribute('data-name');
                if (playerName.includes(search)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Ê∏∏ÊàèËßÑÂàôÁÆ°ÁêÜÂäüËÉΩ
        function getGameRules() {
            sendRequest('gamerules', [])
                .then(result => {
                    currentRules = result;
                    displayGameRules(result);
                    addLog(`‚úÖ Ëé∑ÂèñÂà∞ ${result.length} Êù°Ê∏∏ÊàèËßÑÂàô`, 'success');
                })
                .catch((error) => {
                    addLog('‚ùå Ëé∑ÂèñÊ∏∏ÊàèËßÑÂàôÂ§±Ë¥•: ' + error.message, 'error');
                    displayGameRules([]);
                });
        }

        function displayGameRules(gamerules) {
            const container = document.getElementById('gameRulesList');
            
            if (gamerules.length === 0) {
                container.innerHTML = '<div class="empty-state">Ê≤°ÊúâÊ∏∏ÊàèËßÑÂàô</div>';
                return;
            }

            // ÊåâÂàÜÁ±ªÂàÜÁªÑ
            const categorizedRules = {};
            gamerules.forEach(rule => {
                const category = ruleCategories[rule.key] || 'other';
                if (!categorizedRules[category]) {
                    categorizedRules[category] = [];
                }
                categorizedRules[category].push(rule);
            });

            let html = '';
            
            // ÊòæÁ§∫ÂêÑ‰∏™ÂàÜÁ±ª
            const categoryOrder = ['gameplay', 'world', 'player', 'mob', 'chat', 'other'];
            categoryOrder.forEach(category => {
                if (categorizedRules[category]) {
                    const categoryName = {
                        'gameplay': 'üéÆ Ê∏∏ÊàèÁé©Ê≥ï',
                        'world': 'üåç ‰∏ñÁïåËÆæÁΩÆ',
                        'player': 'üë§ Áé©ÂÆ∂Áõ∏ÂÖ≥',
                        'mob': 'üêæ ÁîüÁâ©Áõ∏ÂÖ≥',
                        'chat': 'üí¨ ËÅäÂ§©Áõ∏ÂÖ≥',
                        'other': 'üì¶ ÂÖ∂‰ªñËßÑÂàô'
                    }[category];
                    
                    html += `<div class="gamerule-category">
                        <h3>${categoryName}</h3>
                        ${categorizedRules[category].map(rule => createRuleHTML(rule)).join('')}
                    </div>`;
                }
            });

            container.innerHTML = html;
        }

        function createRuleHTML(rule) {
            const description = ruleDescriptions[rule.key] || 'ÊöÇÊó†ÊèèËø∞';
            const valueType = detectValueType(rule.value);
            const category = ruleCategories[rule.key] || 'other';
            
            return `
                <div class="gamerule-item" data-type="${valueType}" data-category="${category}" data-name="${rule.key.toLowerCase()}">
                    <div class="gamerule-info">
                        <div class="gamerule-name">
                            ${rule.key}
                            <span class="gamerule-type ${valueType}">${getTypeName(valueType)}</span>
                        </div>
                        <div class="gamerule-description">${description}</div>
                    </div>
                    <div class="gamerule-controls">
                        ${createRuleControl(rule, valueType)}
                    </div>
                </div>
            `;
        }

        function createRuleControl(rule, valueType) {
            const ruleId = `rule_${rule.key.replace(/[^a-zA-Z0-9]/g, '_')}`;
            
            // Áªü‰∏ÄÂ§ÑÁêÜÂ∏ÉÂ∞îÂÄºÔºåÊó†ËÆ∫ÂéüÂßãÁ±ªÂûãÊòØ‰ªÄ‰πà
            const isBooleanValue = valueType === 'boolean';
            const boolValue = isBooleanValue ? 
                (typeof rule.value === 'boolean' ? rule.value : rule.value === 'true') : 
                false;
            
            if (isBooleanValue) {
                return `
                    <span class="gamerule-value ${boolValue}">${boolValue ? 'ÂºÄÂêØ' : 'ÂÖ≥Èó≠'}</span>
                    <button class="gamerule-btn toggle ${boolValue ? '' : 'off'}" 
                            onclick="toggleRule('${rule.key}', ${!boolValue})">
                        ${boolValue ? 'ÂºÄ' : 'ÂÖ≥'}
                    </button>
                `;
            }
            
            switch (valueType) {
                case 'number':
                    return `
                        <input type="number" class="number-input" id="${ruleId}" value="${rule.value}" 
                               onchange="updateRuleValue('${rule.key}', this.value)">
                        <button class="gamerule-btn apply" onclick="applyRule('${rule.key}')">‚úÖ Â∫îÁî®</button>
                        <button class="gamerule-btn reset" onclick="resetRule('${rule.key}')">üîÑ ÈáçÁΩÆ</button>
                    `;
                
                case 'string':
                    return `
                        <input type="text" class="text-input" id="${ruleId}" value="${rule.value}" 
                               onchange="updateRuleValue('${rule.key}', this.value)">
                        <button class="gamerule-btn apply" onclick="applyRule('${rule.key}')">‚úÖ Â∫îÁî®</button>
                        <button class="gamerule-btn reset" onclick="resetRule('${rule.key}')">üîÑ ÈáçÁΩÆ</button>
                    `;
                
                default:
                    return `
                        <span class="gamerule-value">${rule.value}</span>
                    `;
            }
        }

        function detectValueType(value) {
            // È¶ñÂÖàÊ£ÄÊü•ÊòØÂê¶ÊòØÂ∏ÉÂ∞îÂÄºÔºàÂåÖÊã¨Â≠óÁ¨¶‰∏≤ÂΩ¢ÂºèÁöÑÂ∏ÉÂ∞îÂÄºÔºâ
            if (typeof value === 'boolean') return 'boolean';
            if (value === 'true' || value === 'false') return 'boolean';
            
            // ÁÑ∂ÂêéÊ£ÄÊü•ÊòØÂê¶ÊòØÊï∞Â≠ó
            if (typeof value === 'number') return 'number';
            if (!isNaN(value) && value.toString().trim() !== '') return 'number';
            
            // ÈªòËÆ§‰∏∫Â≠óÁ¨¶‰∏≤
            return 'string';
        }

        function getTypeName(type) {
            return {
                'boolean': 'Â∏ÉÂ∞î',
                'number': 'Êï∞Â≠ó',
                'string': 'ÊñáÊú¨'
            }[type];
        }

        // ËßÑÂàôÊìç‰ΩúÂáΩÊï∞
        function toggleRule(ruleKey, newValue) {
            addLog(`üîÑ ÂàáÊç¢ËßÑÂàô ${ruleKey}: ${newValue ? 'ÂºÄÂêØ' : 'ÂÖ≥Èó≠'}`, 'info');
            
            // ÊúçÂä°Âô®ÈúÄË¶ÅÂ≠óÁ¨¶‰∏≤ÂΩ¢ÂºèÁöÑÂ∏ÉÂ∞îÂÄº
            const stringValue = newValue ? "true" : "false";
            
            // Áõ¥Êé•ÂèëÈÄÅËØ∑Ê±ÇÊõ¥Êñ∞ËßÑÂàô
            sendRequest('gamerules/update', [{ key: ruleKey, value: stringValue }])
                .then(() => {
                    addLog(`‚úÖ Ê∏∏ÊàèËßÑÂàôÂ∑≤Êõ¥Êñ∞: ${ruleKey} = ${stringValue}`, 'success');
                    // Á´ãÂç≥Êõ¥Êñ∞ÁïåÈù¢ÊòæÁ§∫
                    updateRuleDisplay(ruleKey, newValue);
                })
                .catch((error) => {
                    addLog(`‚ùå Êõ¥Êñ∞Ê∏∏ÊàèËßÑÂàôÂ§±Ë¥•: ${ruleKey} - ${error.message}`, 'error');
                    // ÊÅ¢Â§çÂéüÂÄº
                    getGameRules();
                });
        }

        function updateRuleDisplay(ruleKey, newValue) {
            const ruleItem = document.querySelector(`[data-name="${ruleKey.toLowerCase()}"]`);
            if (ruleItem) {
                const valueElement = ruleItem.querySelector('.gamerule-value');
                const toggleButton = ruleItem.querySelector('.gamerule-btn.toggle');
                
                if (valueElement) {
                    valueElement.textContent = newValue ? 'ÂºÄÂêØ' : 'ÂÖ≥Èó≠';
                    valueElement.className = `gamerule-value ${newValue}`;
                }
                
                if (toggleButton) {
                    toggleButton.textContent = newValue ? 'ÂºÄ' : 'ÂÖ≥';
                    toggleButton.className = `gamerule-btn toggle ${newValue ? '' : 'off'}`;
                    // Êõ¥Êñ∞ÁÇπÂáª‰∫ã‰ª∂Ôºå‰ΩøÁî®Êñ∞ÁöÑÂÄº
                    toggleButton.setAttribute('onclick', `toggleRule('${ruleKey}', ${!newValue})`);
                }
            }
        }

        function updateRuleValue(ruleKey, newValue) {
            addLog(`üìù Êõ¥Êñ∞ËßÑÂàô ${ruleKey}: ${newValue}`, 'info');
        }

        function applyRule(ruleKey) {
            const ruleId = `rule_${ruleKey.replace(/[^a-zA-Z0-9]/g, '_')}`;
            const inputElement = document.getElementById(ruleId);
            let newValue;

            if (inputElement.type === 'checkbox') {
                newValue = inputElement.checked;
            } else {
                newValue = inputElement.value;
                // Â∞ùËØïËΩ¨Êç¢‰∏∫Êï∞Â≠ó
                if (!isNaN(newValue) && newValue.trim() !== '') {
                    newValue = Number(newValue);
                }
            }

            // ÂØπ‰∫éÂ∏ÉÂ∞îÁ±ªÂûãÁöÑËßÑÂàôÔºåÈúÄË¶ÅËΩ¨Êç¢‰∏∫Â≠óÁ¨¶‰∏≤
            const ruleItem = document.querySelector(`[data-name="${ruleKey.toLowerCase()}"]`);
            if (ruleItem && ruleItem.getAttribute('data-type') === 'boolean') {
                newValue = newValue ? "true" : "false";
            } else if (ruleItem && ruleItem.getAttribute('data-type') === 'number') {
                // ÂØπ‰∫éÊï∞Â≠óÁ±ªÂûãÁöÑËßÑÂàôÔºåÁ°Æ‰øù‰º†ÈÄíÂ≠óÁ¨¶‰∏≤ËÄå‰∏çÊòØÊï∞Â≠ó
                newValue = newValue.toString();
            }

            sendRequest('gamerules/update', [{ key: ruleKey, value: newValue }])
                .then(() => {
                    addLog(`‚úÖ Ê∏∏ÊàèËßÑÂàôÂ∑≤Êõ¥Êñ∞: ${ruleKey} = ${newValue}`, 'success');
                    // ÈáçÊñ∞Âä†ËΩΩ‰ª•Á°ÆËÆ§Êõ¥Êñ∞
                    setTimeout(() => getGameRules(), 500);
                })
                .catch((error) => {
                    addLog(`‚ùå Êõ¥Êñ∞Ê∏∏ÊàèËßÑÂàôÂ§±Ë¥•: ${ruleKey} - ${error.message}`, 'error');
                    // ÊÅ¢Â§çÂéüÂÄº
                    getGameRules();
                });
        }

        function resetRule(ruleKey) {
            const defaultValue = defaultValues[ruleKey];
            if (defaultValue !== undefined) {
                sendRequest('gamerules/update', [{ key: ruleKey, value: defaultValue }])
                    .then(() => {
                        addLog(`‚úÖ ËßÑÂàôÂ∑≤ÈáçÁΩÆ: ${ruleKey} = ${defaultValue}`, 'success');
                        setTimeout(() => getGameRules(), 500);
                    })
                    .catch((error) => {
                        addLog(`‚ùå ÈáçÁΩÆËßÑÂàôÂ§±Ë¥•: ${ruleKey} - ${error.message}`, 'error');
                    });
            } else {
                addLog(`‚ö†Ô∏è Êú™Áü•ËßÑÂàôÁöÑÈªòËÆ§ÂÄº: ${ruleKey}`, 'warning');
            }
        }

        function resetAllRules() {
            if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÊ∏∏ÊàèËßÑÂàô‰∏∫ÈªòËÆ§ÂÄºÂêóÔºü')) {
                addLog('üîÑ Ê≠£Âú®ÈáçÁΩÆÊâÄÊúâÊ∏∏ÊàèËßÑÂàô...', 'info');
                
                // Ëé∑ÂèñÂΩìÂâçËßÑÂàôÁÑ∂ÂêéÈáçÁΩÆ
                sendRequest('gamerules', [])
                    .then(rules => {
                        let resetPromises = [];
                        rules.forEach(rule => {
                            const defaultValue = defaultValues[rule.key];
                            if (defaultValue !== undefined && rule.value !== defaultValue) {
                                resetPromises.push(
                                    sendRequest('gamerules/update', [{ key: rule.key, value: defaultValue }])
                                );
                            }
                        });
                        
                        return Promise.allSettled(resetPromises);
                    })
                    .then(results => {
                        const successful = results.filter(r => r.status === 'fulfilled').length;
                        const failed = results.filter(r => r.status === 'rejected').length;
                        
                        addLog(`‚úÖ ÈáçÁΩÆÂÆåÊàê: ${successful} Êù°ËßÑÂàôÊàêÂäü, ${failed} Êù°ËßÑÂàôÂ§±Ë¥•`, 'success');
                        getGameRules();
                    })
                    .catch(error => {
                        addLog(`‚ùå ÈáçÁΩÆËøáÁ®ãÂá∫Èîô: ${error.message}`, 'error');
                    });
            }
        }

        // Á≠õÈÄâÂäüËÉΩ
        function filterRules() {
            const searchTerm = document.getElementById('ruleSearch').value.toLowerCase();
            const categoryFilter = document.getElementById('ruleCategoryFilter').value;
            
            const rules = document.querySelectorAll('.gamerule-item');
            
            rules.forEach(rule => {
                const ruleName = rule.getAttribute('data-name');
                const ruleCategory = rule.getAttribute('data-category');
                
                const matchesSearch = ruleName.includes(searchTerm);
                const matchesCategory = categoryFilter === 'all' || ruleCategory === categoryFilter;
                
                if (matchesSearch && matchesCategory) {
                    rule.style.display = 'flex';
                } else {
                    rule.style.display = 'none';
                }
            });
        }

        // Ê£ÄÊü•ÊúçÂä°Âô®Áä∂ÊÄÅ
        async function checkServerStatus() {
            try {
                const response = await fetch('/api/server/status', {
                    headers: {
                        'X-Session-ID': sessionId
                    }
                });
                
                const result = await response.json();
                serverRunning = result.running;
                
                const indicator = document.getElementById('serverStatusIndicator');
                const statusText = document.getElementById('serverStatusText');
                const startBtn = document.getElementById('startServerBtn');
                const normalStopBtn = document.getElementById('normalStopBtn');
                const forceStopBtn = document.getElementById('forceStopBtn');
                
                if (serverRunning) {
                    indicator.className = 'server-indicator on';
                    statusText.textContent = 'ÊúçÂä°Âô®Áä∂ÊÄÅ: ËøêË°å‰∏≠';
                    startBtn.disabled = true;
                    normalStopBtn.disabled = false;
                    forceStopBtn.disabled = false;
                    startBtn.innerHTML = 'üöÄ ËøêË°å‰∏≠';
                    normalStopBtn.innerHTML = 'üõë ÂÅúÊ≠¢ÊúçÂä°Âô®';
                    forceStopBtn.innerHTML = '‚õî Âº∫Âà∂ÂÅúÊ≠¢';
                } else {
                    indicator.className = 'server-indicator off';
                    statusText.textContent = 'ÊúçÂä°Âô®Áä∂ÊÄÅ: Â∑≤ÂÅúÊ≠¢';
                    startBtn.disabled = false;
                    normalStopBtn.disabled = true;
                    forceStopBtn.disabled = true;
                    startBtn.innerHTML = 'üöÄ ÂêØÂä®ÊúçÂä°Âô®';
                    normalStopBtn.innerHTML = 'üõë Â∑≤ÂÅúÊ≠¢';
                    forceStopBtn.innerHTML = '‚õî Âº∫Âà∂ÂÅúÊ≠¢';
                    
                    // ÊúçÂä°Âô®ÂÅúÊ≠¢Êó∂Êõ¥Êñ∞ RCON Áä∂ÊÄÅ
                    rconEnabled = false;
                    updateRconStatusDisplay();
                }
            } catch (error) {
                console.error('Ê£ÄÊü•ÊúçÂä°Âô®Áä∂ÊÄÅÂ§±Ë¥•:', error);
                // Â¶ÇÊûúÊ£ÄÊü•Â§±Ë¥•ÔºåÂÅáËÆæÊúçÂä°Âô®Â∑≤ÂÅúÊ≠¢
                serverRunning = false;
                updateServerStatusDisplay(false);
            }
        }

        // Êõ¥Êñ∞ÊúçÂä°Âô®Áä∂ÊÄÅÊòæÁ§∫
        function updateServerStatusDisplay(isRunning) {
            const indicator = document.getElementById('serverStatusIndicator');
            const statusText = document.getElementById('serverStatusText');
            const startBtn = document.getElementById('startServerBtn');
            const normalStopBtn = document.getElementById('normalStopBtn');
            const forceStopBtn = document.getElementById('forceStopBtn');
            
            if (isRunning) {
                indicator.className = 'server-indicator on';
                statusText.textContent = 'ÊúçÂä°Âô®Áä∂ÊÄÅ: ËøêË°å‰∏≠';
                startBtn.disabled = true;
                normalStopBtn.disabled = false;
                forceStopBtn.disabled = false;
                startBtn.innerHTML = 'üöÄ ËøêË°å‰∏≠';
                normalStopBtn.innerHTML = 'üõë ÂÅúÊ≠¢ÊúçÂä°Âô®';
                forceStopBtn.innerHTML = '‚õî Âº∫Âà∂ÂÅúÊ≠¢';
            } else {
                indicator.className = 'server-indicator off';
                statusText.textContent = 'ÊúçÂä°Âô®Áä∂ÊÄÅ: Â∑≤ÂÅúÊ≠¢';
                startBtn.disabled = false;
                normalStopBtn.disabled = true;
                forceStopBtn.disabled = true;
                startBtn.innerHTML = 'üöÄ ÂêØÂä®ÊúçÂä°Âô®';
                normalStopBtn.innerHTML = 'üõë Â∑≤ÂÅúÊ≠¢';
                forceStopBtn.innerHTML = '‚õî Âº∫Âà∂ÂÅúÊ≠¢';
            }
        }

        // ÂêØÂä®ÊúçÂä°Âô®
        async function startServer() {
            if (!confirm('Á°ÆÂÆöË¶ÅÂêØÂä® Minecraft ÊúçÂä°Âô®ÂêóÔºü')) return;
            
            addLog('üîÑ Ê≠£Âú®ÂêØÂä®ÊúçÂä°Âô®...', 'info');
            
            try {
                const response = await fetch('/api/server/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog(`‚úÖ ${result.message}`, 'success');
                    // ÂêØÂä®ÂêéÂª∂ËøüÊ£ÄÊü•Áä∂ÊÄÅ
                    setTimeout(() => {
                        checkServerStatus();
                    }, 5000);
                } else {
                    addLog(`‚ùå ${result.message}`, 'error');
                }
            } catch (error) {
                addLog(`‚ùå ÂêØÂä®ÊúçÂä°Âô®Â§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // Âº∫Âà∂ÂÅúÊ≠¢ÊúçÂä°Âô®
        async function forceStopServer() {
            if (!confirm('Á°ÆÂÆöË¶ÅÂº∫Âà∂ÂÅúÊ≠¢ÊúçÂä°Âô®ÂêóÔºüËøôÂèØËÉΩ‰ºöÈÄ†ÊàêÊï∞ÊçÆ‰∏¢Â§±ÔºÅ')) return;
            
            addLog('üõë Ê≠£Âú®Âº∫Âà∂ÂÅúÊ≠¢ÊúçÂä°Âô®...', 'warning');
            
            try {
                const response = await fetch('/api/server/stop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog(`‚úÖ ${result.message}`, 'success');
                    // Âº∫Âà∂ÂÅúÊ≠¢ÂêéÁ´ãÂç≥Êõ¥Êñ∞Áä∂ÊÄÅ
                    setTimeout(() => {
                        checkServerStatus();
                        checkRconStatus();
                        // Êñ≠ÂºÄ WebSocket ËøûÊé•
                        if (ws) {
                            disconnect();
                        }
                    }, 2000);
                } else {
                    addLog(`‚ùå ${result.message}`, 'error');
                }
            } catch (error) {
                addLog(`‚ùå ÂÅúÊ≠¢ÊúçÂä°Âô®Â§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // ÂàùÂßãÂåñÈ°µÈù¢
        document.addEventListener('DOMContentLoaded', function() {
            // Ê£ÄÊü•ÊòØÂê¶Êúâ‰øùÂ≠òÁöÑ‰ºöËØù
            const savedSession = localStorage.getItem('mc_session');
            if (savedSession) {
                sessionId = savedSession;
                // È™åËØÅ‰ºöËØùÊúâÊïàÊÄß
                checkSessionValidity();
            }
            
            // ÁªëÂÆöÂõûËΩ¶ÈîÆÂà∞ÁôªÂΩï
            document.getElementById('loginPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            // ËÆæÁΩÆÈªòËÆ§ÂÄº
            document.getElementById('wsHost').value = '';
            document.getElementById('wsPort').value = '';
            
            // ÊòæÁ§∫ÁôªÂΩïÁïåÈù¢
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('mainInterface').style.display = 'none';
        });

        // Ê£ÄÊü•‰ºöËØùÊúâÊïàÊÄß
        async function checkSessionValidity() {
            try {
                const response = await fetch('/api/check', {
                    headers: {
                        'X-Session-ID': sessionId
                    }
                });
                
                const result = await response.json();
                if (result.success) {
                    // ‰ºöËØùÊúâÊïàÔºåÁõ¥Êé•ÊòæÁ§∫ÁÆ°ÁêÜÁïåÈù¢
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('mainInterface').style.display = 'block';
                    startStatusPolling();
                    setTimeout(() => connect(), 500);
                } else {
                    // ‰ºöËØùÊó†ÊïàÔºåÊ∏ÖÈô§Â≠òÂÇ®
                    localStorage.removeItem('mc_session');
                    sessionId = null;
                }
            } catch (error) {
                console.error('‰ºöËØùÊ£ÄÊü•Â§±Ë¥•:', error);
                localStorage.removeItem('mc_session');
                sessionId = null;
            }
        }
    </script>
</body>
</html>